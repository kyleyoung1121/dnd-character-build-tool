const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["../chunks/HFu_ANCm.js","../chunks/DsnmJJEf.js","../chunks/CLB9eUYX.js","../chunks/rn6nHgdH.js","../chunks/CAQU5EIs.js","../chunks/hD6VUnFp.js","../chunks/Rsg3wwRt.js","../chunks/Cb9z2JfB.js","../chunks/ZJQv4x7Q.js","../chunks/bMg-MY57.js","../chunks/Dnzb4z2X.js","../chunks/CIqA3WZi.js","../chunks/2B6LwRL0.js","../chunks/BbUdCK9o.js","../chunks/u1FZ14JW.js","../chunks/Co363syM.js","../chunks/BeNoI1Wt.js","../assets/ConflictWarning.DAoTGsol.css","../chunks/BXwS9YYZ.js","../chunks/CHpWTfCS.js","../chunks/COMRBWPk.js","../assets/FeatureCardList.BJXFrnpP.css"])))=>i.map(i=>d[i]);
import{_ as ge}from"../chunks/D9Z9MdNV.js";import"../chunks/DsnmJJEf.js";import"../chunks/CLB9eUYX.js";import{o as ve}from"../chunks/0mxveq2f.js";import{W as fe,ar as Y,as as we,X as P,Y as A,Z as ye,d as e,$ as w,j as y,z as x,at as G,_ as b,a0 as v,au as M,v as D,av as be}from"../chunks/rn6nHgdH.js";import{g as T,a as F,e as S}from"../chunks/ZJQv4x7Q.js";import{i as W}from"../chunks/Co363syM.js";import{e as Z,i as J}from"../chunks/CAQU5EIs.js";import{C as he,h as _e}from"../chunks/BeNoI1Wt.js";import{s as N}from"../chunks/BXwS9YYZ.js";import{i as De}from"../chunks/hD6VUnFp.js";import{b as Re}from"../chunks/CI2IoGDg.js";import{i as ke,F as Ce}from"../chunks/HFu_ANCm.js";import{b as xe,a as Fe,c as Oe,d as $e,f as Ae,m as Pe,p as Se,r as Ne,e as Ee,s as Be,w as Ke,g as Le}from"../chunks/BH-lYZvk.js";import{a as Q,r as ee}from"../chunks/Dnzb4z2X.js";import{c as E}from"../chunks/CIqA3WZi.js";var Me=P('<button class="class-card svelte-wt0gmw"><div class="card-left svelte-wt0gmw"><img class="svelte-wt0gmw"/> <span> </span></div> <img class="card-arrow svelte-wt0gmw" alt="next arrow"/></button>'),Ve=P('<div class="class-cards svelte-wt0gmw"></div>'),Ie=P('<div class="feature-card svelte-wt0gmw"><h4> </h4> <p><!></p></div>'),je=P('<div class="popup svelte-wt0gmw"><div class="popup-content svelte-wt0gmw"><div class="popup-header svelte-wt0gmw"><span>CONFIRM ADD CLASS</span> <button class="close-button svelte-wt0gmw">√ó</button></div> <div class="popup-body svelte-wt0gmw"><h2> </h2> <p class="description svelte-wt0gmw"> </p> <p><strong>Primary Ability:</strong> </p> <!></div> <div class="popup-footer svelte-wt0gmw"><button class="cancel-button svelte-wt0gmw">Cancel</button> <button class="add-button svelte-wt0gmw">Add Class</button></div></div></div>'),Ge=P('<div class="selected-class-card svelte-wt0gmw"><div class="selected-class-info svelte-wt0gmw"><img class="selected-class-icon svelte-wt0gmw"/> <div class="selected-class-text svelte-wt0gmw"><h2 class="svelte-wt0gmw"> </h2> <p class="max-hp svelte-wt0gmw"> </p></div> <button class="remove-class-button svelte-wt0gmw" aria-label="Remove selected class">‚úï</button></div> <!></div>'),Te=P(`<div class="main-content svelte-wt0gmw"><!> <p class="intro-text svelte-wt0gmw">In Dungeons & Dragons, your character's class determines what they can do. It marks what role
		your character will play in your party of adventurers. Each class has strengths and weaknesses,
		so its important to use teamwork!</p> <!> <!> <!></div>`);function rs(se,te){fe(te,!1);const B=x(),oe=x(),z=[xe,Fe,Oe,$e,Ae,Pe,Se,Ne,Ee,Be,Ke,Le];let h=x(null),c=x(null),p=x({}),K=x(new Set),L=x(0);function V(){y(L,(e(L)+1)%1e6)}function ae(){if(e(c)){let m=function(t){try{typeof window<"u"&&window.classRemovalDebug&&window.classRemovalDebug.steps.push(`Starting collectFeatureNames with ${t.length} features`);const i=[];for(const l of t)if(console.log("üóëÔ∏è Processing feature:",l.name),i.push(l.name),l.featureOptions){if(console.log("üóëÔ∏è Feature has options, processing..."),l.featureOptions.dynamicOptionsGenerator){console.log("üóëÔ∏è Skipping dynamic options feature:",l.name);continue}const o=l.featureOptions.options;if(Array.isArray(o))for(const f of o)typeof f!="string"&&f.nestedPrompts&&(console.log("üóëÔ∏è Processing nested prompts for option:",f.name),i.push(...m(f.nestedPrompts)));else console.log("üóëÔ∏è Feature options is not an array:",typeof o)}return typeof window<"u"&&window.classRemovalDebug&&window.classRemovalDebug.steps.push(`Collected ${i.length} feature names`),i}catch(i){throw console.error("‚ùå Error in collectFeatureNames:",i),typeof window<"u"&&window.classRemovalDebug&&(window.classRemovalDebug.steps.push(`ERROR in collectFeatureNames: ${i.message}`),window.classRemovalDebug.collectFeatureNamesError=i),i}};console.log("üóëÔ∏è Attempting to remove class:",e(c).name),typeof window<"u"&&(window.classRemovalDebug={attemptedClass:e(c).name,steps:["Starting removal process"],timestamp:new Date().toISOString(),hasExpertiseFeature:e(c).classFeatures?.some(t=>t.name.toLowerCase().includes("expertise")||t.featureOptions?.dynamicOptionsGenerator?.type==="proficient-skills-plus-tools"),expertiseFeatures:e(c).classFeatures?.filter(t=>t.name.toLowerCase().includes("expertise")||t.featureOptions?.dynamicOptionsGenerator?.type==="proficient-skills-plus-tools").map(t=>t.name)});const a=T(E);console.log("üóëÔ∏è Current state:",a);const r=Object.keys(a._provenance||{});console.log("üóëÔ∏è Provenance keys:",r),typeof window<"u"&&window.classRemovalDebug&&(window.classRemovalDebug.steps.push(`Found ${r.length} provenance keys`),window.classRemovalDebug.provKeys=r);let n=[],u=[];try{typeof window<"u"&&window.classRemovalDebug&&window.classRemovalDebug.steps.push("About to collect feature names"),n=m(e(c).classFeatures||[]),console.log("üóëÔ∏è All feature names:",n),typeof window<"u"&&window.classRemovalDebug&&window.classRemovalDebug.steps.push("Feature names collected, creating prefixes"),u=[`class:${e(c).name}`,...n.map(t=>`feature:${t}`),"class_equipment_"],console.log("üóëÔ∏è Prefixes to remove:",u)}catch(t){console.error("‚ùå Error during feature collection:",t),typeof window<"u"&&window.classRemovalDebug&&(window.classRemovalDebug.steps.push(`FATAL ERROR during feature collection: ${t.message}`),window.classRemovalDebug.fatalError=t,window.classRemovalDebug.completed=!1);return}typeof window<"u"&&window.classRemovalDebug&&(window.classRemovalDebug.steps.push(`Collected ${n.length} feature names`),window.classRemovalDebug.featureNames=n,window.classRemovalDebug.prefixes=u);const s=[],d=[];typeof window<"u"&&window.classRemovalDebug&&window.classRemovalDebug.steps.push(`Starting provenance key processing loop with ${r.length} keys`);for(const t of r)if(console.log("üóëÔ∏è Processing key:",t),u.some(i=>t.startsWith(i))){console.log("üóëÔ∏è Reverting key:",t),typeof window<"u"&&window.classRemovalDebug&&window.classRemovalDebug.steps.push(`Processing key: ${t}`),(t.includes("Expertise")||t.includes("expertise"))&&console.log("üîç Expertise key detected:",t);try{const l=a._provenance?.[t];console.log("üìä Provenance data for",t,":",l),ee(a,t),console.log("‚úÖ Successfully reverted:",t),s.push(t)}catch(l){console.error("‚ùå Error reverting key:",t,l),console.error("üìä Error details:",{key:t,error:l.message||l,stack:l.stack,provenanceData:a._provenance?.[t]}),d.push({key:t,error:l.message||l,errorObj:l,provenanceData:a._provenance?.[t]})}}console.log("üóëÔ∏è Completed provenance key processing"),typeof window<"u"&&window.classRemovalDebug&&(window.classRemovalDebug.steps.push(`Completed provenance processing - reverted ${s.length} keys, ${d.length} errors`),window.classRemovalDebug.revertedKeys=s,window.classRemovalDebug.revertErrors=d)}console.log("üóëÔ∏è About to start cleanup phase"),console.log("üóëÔ∏è Cleaning up UI state..."),typeof window<"u"&&window.classRemovalDebug&&window.classRemovalDebug.steps.push("Cleaning up UI state"),y(c,null),y(h,null),y(p,{}),y(K,new Set),V(),typeof window<"u"&&window.classRemovalDebug&&(window.classRemovalDebug.steps.push("Class removal completed successfully"),window.classRemovalDebug.completed=!0),console.log("üóëÔ∏è Class removal complete")}function ne(){if(e(h)){y(c,e(h)),y(h,null),y(p,{}),y(K,new Set),Q(`class:${e(c).name}`,{class:e(c).name});for(const a of e(c).classFeatures||[]){if(a.featureOptions)continue;const r=`feature:${a.name}`;ee(T(E),r);const m={},n={};for(const u of a.effects||[]){const s=u.target,d=u.value;switch(u.action){case"add":{const t=Array.isArray(d)?d:[d];m[s]||(m[s]=[]),m[s].push(...t);break}case"set":{m[s]=d;break}case"modify":{const t=Number(d);isNaN(t)||(n[s]=(n[s]??0)+t);break}}}Q(r,m,n)}V()}}function re(a){if(!a)return"N/A";const r=a.match(/d(\d+)/);if(!r)return"N/A";const m=parseInt(r[1],10),n=Math.floor(m/2)+1;return m+n*2}function le(a,r){if(a.length<r){const m=a.length;a.length=r;for(let n=m;n<r;n++)a[n]=null}}ve(async()=>{const a=T(E);if(!a.class)return;const r=z.find(s=>s.name===a.class);if(!r)return;y(c,r),y(p,{});const m=s=>s.toLowerCase().replace(/\s+/g,"_"),n=(s,d)=>{const t=m(s);for(const[i,l]of d.entries())if(t.includes(i))return l;return null},u=async s=>{const d=s.featureOptions?.numPicks||1;e(p)[s.name]?le(e(p)[s.name],d):G(p,e(p)[s.name]=Array(d).fill(null));let t=s.featureOptions?.options||[];if(s.featureOptions?.dynamicOptionsGenerator)try{const{generateDynamicOptions:o}=await ge(async()=>{const{generateDynamicOptions:g}=await import("../chunks/HFu_ANCm.js").then(_=>_.f);return{generateDynamicOptions:g}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21]),import.meta.url);t=o(s.featureOptions.dynamicOptionsGenerator,E,e(p)).map(g=>typeof g=="string"?g:g.name)}catch(o){console.warn("Failed to generate dynamic options for restoration:",o)}const i=new Map(t.map(o=>[m(typeof o=="string"?o:o.name),typeof o=="string"?o:o.name])),l=a._provenance||{};s.name==="Bard College"&&console.log("üéµ Bard College restoration debug:",{featureName:s.name,numPicks:d,currentFeatureSelections:e(p)[s.name],optionMap:Array.from(i.entries()),provenanceKeys:Object.keys(l).filter(o=>o.includes("Bard College"))});for(let o=0;o<d;o++){if(e(p)[s.name][o])continue;const f=`feature:${s.name}:${o}`,g=l[f];s.name==="Bard College"&&console.log("üéµ Bard College key debug:",{key:f,idx:o,stored:g,provenanceExists:!!g});let _=null;if(g?._set)for(const R of s.effects||[]){const C=R.target,O=g._set[C];if(Array.isArray(O))for(const k of O){const $=n(k,i);if($){_=$;break}}else if(typeof O=="string"){const k=n(O,i);k&&(_=k)}if(_)break}if(!_&&g?._mods)for(const R of Object.keys(g._mods)){const C=n(R,i);if(C){_=C;break}}_?(s.name==="Bard College"&&console.log("üéµ Bard College value restored:",_),G(p,e(p)[s.name][o]=_)):s.name==="Bard College"&&console.log("üéµ Bard College value NOT restored for idx:",o)}if(s.featureOptions?.options){for(const o of s.featureOptions.options)if(typeof o!="string"&&o.nestedPrompts){const f=e(p)[s.name].find(g=>g===o.name);if(s.name==="Bard College"&&console.log("üéµ Bard College nested restoration debug:",{featureName:s.name,optionName:o.name,currentSelections:e(p)[s.name],selectedVal:f,hasNestedPrompts:!!o.nestedPrompts,nestedPromptCount:o.nestedPrompts?.length||0}),f){s.name==="Bard College"&&console.log("üéµ Processing Bard College nested prompts for:",f);for(const g of o.nestedPrompts)await u(g)}else{for(const g of o.nestedPrompts){const _=`feature:${g.name}:0`;if(l[_]){if(s.name==="Bard College"&&console.log("üéµ Found nested provenance data, attempting restoration for:",g.name),!e(p)[s.name].includes(o.name)){const R=e(p)[s.name].findIndex(C=>C===null);R!==-1&&(s.name==="Bard College"&&console.log("üéµ Setting parent selection to:",o.name),G(p,e(p)[s.name][R]=o.name))}await u(g)}}s.name==="Bard College"&&console.log("üéµ No selection found for Bard College option:",o.name)}}}};for(const s of r.classFeatures||[])await u(s);y(p,{...e(p)}),V()}),Y(()=>e(c),()=>{y(B,e(c)?[...e(c).classFeatures||[]]:[])}),Y(()=>(e(B),e(p)),()=>{y(oe,e(B).map(a=>({feature:a,incomplete:ke(a,e(p))})))}),we(),De();var I=Te(),H=w(I);he(H,{tabName:"class"});var U=b(H,4);{var ie=a=>{var r=Ve();Z(r,5,()=>z,J,(m,n)=>{var u=Me(),s=w(u),d=w(s),t=b(d,2),i=w(t,!0);v(t),v(s);var l=b(s,2);v(u),M(()=>{N(d,"src",(e(n),D(()=>e(n).image))),N(d,"alt",(e(n),D(()=>`${e(n).name} icon`))),F(i,(e(n),D(()=>e(n).name))),N(l,"src",`${Re??""}/basic_icons/blue_next.png`)}),S("click",u,()=>y(h,e(n))),A(m,u)}),v(r),A(a,r)};W(U,a=>{e(c)||a(ie)})}var q=b(U,2);{var ce=a=>{var r=je(),m=w(r),n=w(m),u=b(w(n),2);v(n);var s=b(n,2),d=w(s),t=w(d,!0);v(d);var i=b(d,2),l=w(i,!0);v(i);var o=b(i,2),f=b(w(o));v(o);var g=b(o,2);Z(g,1,()=>(e(h),D(()=>e(h).classFeatures)),J,(O,k)=>{var $=Ie(),j=w($),pe=w(j,!0);v(j);var X=b(j,2),ue=w(X);_e(ue,()=>(e(k),D(()=>e(k).description))),v(X),v($),M(()=>F(pe,(e(k),D(()=>e(k).name)))),A(O,$)}),v(s);var _=b(s,2),R=w(_),C=b(R,2);v(_),v(m),v(r),M(()=>{F(t,(e(h),D(()=>e(h).name))),F(l,(e(h),D(()=>e(h).description))),F(f,` ${e(h),D(()=>e(h).primaryAbility)??""}`)}),S("click",u,()=>y(h,null)),S("click",R,()=>y(h,null)),S("click",C,ne),A(a,r)};W(q,a=>{e(h)&&a(ce)})}var de=b(q,2);{var me=a=>{var r=Ge(),m=w(r),n=w(m),u=b(n,2),s=w(u),d=w(s,!0);v(s);var t=b(s,2),i=w(t);v(t),v(u);var l=b(u,2);v(m);var o=b(m,2);Ce(o,{get features(){return e(B)},get selectionVersion(){return e(L)},get characterStore(){return E},onBumpVersion:()=>be(L),get featureSelections(){return e(p)},set featureSelections(f){y(p,f)},get expandedFeatures(){return e(K)},set expandedFeatures(f){y(K,f)},$$legacy:!0}),v(r),M(f=>{N(n,"src",(e(c),D(()=>e(c).image))),N(n,"alt",(e(c),D(()=>`${e(c).name} icon`))),F(d,(e(c),D(()=>e(c).name))),F(i,`Average Health: ${f??""}`)},[()=>(e(c),D(()=>re(e(c).hitDie)))]),S("click",l,ae),A(a,r)};W(de,a=>{e(c)&&a(me)})}v(I),A(se,I),ye()}export{rs as component};
