import"../chunks/DsnmJJEf.js";import"../chunks/69_IOA4Y.js";import{o as he}from"../chunks/CuATEbiF.js";import{x as xe,af as re,ag as Fe,y as A,z as w,A as Oe,a as e,s as m,ah as B,ai as Y,C as o,B as l,E as r,aj as V,u as y,ak as Pe}from"../chunks/Bdjag3zs.js";import{g as H,s as O,e as D}from"../chunks/BVPYibDR.js";import{i as M}from"../chunks/vJ5Czfxm.js";import{e as J,i as Q}from"../chunks/So6lF2Dq.js";import{C as Ce,i as $e,h as we,F as Ae}from"../chunks/CAdLWwuC.js";import{s as R}from"../chunks/C6ClwP9-.js";import{i as Se}from"../chunks/BbSQGgxI.js";import{b as Be}from"../chunks/D0OSC6O8.js";import{b as oe}from"../chunks/l0VfoFT7.js";import{a as ne,r as ce}from"../chunks/bWUy9njV.js";import{c as z}from"../chunks/BMQPE_bs.js";var Ve=A('<button class="background-card svelte-1ec9l8y"><div class="card-left svelte-1ec9l8y"><img class="svelte-1ec9l8y"/> <span> </span></div> <img class="card-arrow svelte-1ec9l8y" alt="next arrow"/></button>'),je=A('<div class="background-cards svelte-1ec9l8y"></div>'),Ee=A('<div class="detail-section svelte-1ec9l8y"><h4 class="svelte-1ec9l8y">Languages</h4> <p class="svelte-1ec9l8y"> </p></div>'),Le=A('<div class="detail-section svelte-1ec9l8y"><h4 class="svelte-1ec9l8y">Tool Proficiencies</h4> <p class="svelte-1ec9l8y"> </p></div>'),Ne=A("<li> </li>"),De=A('<div class="feature-card svelte-1ec9l8y"><h4 class="svelte-1ec9l8y"> </h4> <p class="svelte-1ec9l8y"><!></p></div>'),Me=A('<div class="popup svelte-1ec9l8y"><div class="popup-content svelte-1ec9l8y"><div class="popup-header svelte-1ec9l8y"><span>CONFIRM ADD BACKGROUND</span> <button class="close-button svelte-1ec9l8y">×</button></div> <div class="popup-body svelte-1ec9l8y"><h2> </h2> <p class="description svelte-1ec9l8y"> </p> <div class="background-details svelte-1ec9l8y"><div class="detail-section svelte-1ec9l8y"><h4 class="svelte-1ec9l8y">Skill Proficiencies</h4> <p class="svelte-1ec9l8y"> </p></div> <!> <!> <div class="detail-section svelte-1ec9l8y"><h4 class="svelte-1ec9l8y">Equipment</h4> <ul class="svelte-1ec9l8y"></ul></div></div> <!></div> <div class="popup-footer svelte-1ec9l8y"><button class="cancel-button svelte-1ec9l8y">Cancel</button> <button class="add-button svelte-1ec9l8y">Add Background</button></div></div></div>'),Re=A('<div class="selected-background-card svelte-1ec9l8y"><div class="selected-background-info svelte-1ec9l8y"><img class="selected-background-icon svelte-1ec9l8y"/> <div class="selected-background-text svelte-1ec9l8y"><h2 class="svelte-1ec9l8y"> </h2> <p class="description svelte-1ec9l8y"> </p></div> <button class="remove-background-button svelte-1ec9l8y" aria-label="Remove selected background">✕</button></div> <!></div>'),qe=A(`<div class="main-content svelte-1ec9l8y"><!> <p class="intro-text svelte-1ec9l8y">Your character's background reveals where you came from, how you became an adventurer, 
		and your place in the world. Backgrounds provide skill proficiencies, languages, equipment, 
		and special features that reflect your past experiences.</p> <!> <!> <!></div>`);function tt(ie,le){xe(le,!1);const q=B(),ve=B();let n=B(null),v=B(null),p=B({}),K=B(new Set),W=B(0);function G(){m(W,(e(W)+1)%1e6)}function de(){if(e(v)){let d=function(t){const c=[];for(const _ of t)if(c.push(_.name),_.featureOptions)for(const g of _.featureOptions.options)typeof g!="string"&&g.nestedPrompts&&c.push(...d(g.nestedPrompts));return c};const s=H(z),i=Object.keys(s._provenance||{}),a=d(e(v).backgroundFeatures||[]),f=[`background:${e(v).name}`,...a.map(t=>`feature:${t}`)];for(const t of i)f.some(c=>t.startsWith(c))&&ce(s,t)}m(v,null),m(n,null),m(p,{}),m(K,new Set),G()}function ue(){if(e(n)){m(v,e(n)),m(n,null),m(p,{}),m(K,new Set),ne(`background:${e(v).name}`,{background:e(v).name});for(const s of e(v).backgroundFeatures||[]){if(s.featureOptions)continue;const i=`feature:${s.name}`;ce(H(z),i);const d={},a={};for(const f of s.effects||[]){const t=f.target,c=f.value;switch(f.action){case"add":{const _=Array.isArray(c)?c:[c];d[t]||(d[t]=[]),d[t].push(..._);break}case"set":{d[t]=c;break}case"modify":{a[t]=(a[t]||0)+c;break}}}(Object.keys(d).length>0||Object.keys(a).length>0)&&ne(i,d,a)}for(const s of e(v).backgroundFeatures||[])if(s.featureOptions){const i=s.featureOptions.numPicks;Y(p,e(p)[s.name]=new Array(i).fill(null))}G()}}function pe(s,i){if(s.length<i){const d=s.length;s.length=i;for(let a=d;a<i;a++)s[a]=null}}he(()=>{const s=H(z);if(!s.background)return;const i=oe.find(t=>t.name===s.background);if(!i)return;m(v,i),m(p,{});const d=t=>t.toLowerCase().replace(/\s+/g,"_"),a=(t,c)=>{const _=d(t);for(const[g,P]of c.entries())if(_.includes(g))return P;return null},f=t=>{const c=t.featureOptions?.numPicks||1;e(p)[t.name]?pe(e(p)[t.name],c):Y(p,e(p)[t.name]=Array(c).fill(null));const _=t.featureOptions?.options||[],g=new Map(_.map(u=>[d(typeof u=="string"?u:u.name),typeof u=="string"?u:u.name])),P=s._provenance||{};for(let u=0;u<c;u++){if(e(p)[t.name][u])continue;const F=`feature:${t.name}:${u}`,x=P[F];let C=null;if(x?._set)for(const j of t.effects||[]){const E=j.target,S=x._set[E];if(Array.isArray(S))for(const L of S){const N=a(L,g);if(N){C=N;break}}else if(typeof S=="string"){const L=a(S,g);L&&(C=L)}if(C)break}if(!C&&x?._mods)for(const j of Object.keys(x._mods)){const E=a(j,g);if(E){C=E;break}}C&&Y(p,e(p)[t.name][u]=C)}t.featureOptions?.options&&t.featureOptions.options.forEach(u=>{typeof u!="string"&&u.nestedPrompts&&e(p)[t.name].find(x=>x===u.name)&&u.nestedPrompts.forEach(x=>f(x))})};i.backgroundFeatures?.forEach(t=>f(t)),m(p,{...e(p)}),G()}),re(()=>e(v),()=>{m(q,e(v)?[...e(v).backgroundFeatures||[]]:[])}),re(()=>(e(q),e(p)),()=>{m(ve,e(q).map(s=>({feature:s,incomplete:$e(s,e(p))})))}),Fe(),Se();var T=qe(),X=o(T);Ce(X,{tabName:"background"});var Z=l(X,4);{var fe=s=>{var i=je();J(i,5,()=>oe,Q,(d,a)=>{var f=Ve(),t=o(f),c=o(t),_=l(c,2),g=o(_,!0);r(_),r(t);var P=l(t,2);r(f),V(()=>{R(c,"src",(e(a),y(()=>e(a).image))),R(c,"alt",(e(a),y(()=>`${e(a).name} icon`))),O(g,(e(a),y(()=>e(a).name))),R(P,"src",`${Be??""}/basic_icons/blue_next.png`)}),D("click",f,()=>m(n,e(a))),w(d,f)}),r(i),w(s,i)};M(Z,s=>{e(v)||s(fe)})}var I=l(Z,2);{var me=s=>{var i=Me(),d=o(i),a=o(d),f=l(o(a),2);r(a);var t=l(a,2),c=o(t),_=o(c,!0);r(c);var g=l(c,2),P=o(g,!0);r(g);var u=l(g,2),F=o(u),x=l(o(F),2),C=o(x,!0);r(x),r(F);var j=l(F,2);{var E=k=>{var b=Ee(),h=l(o(b),2),$=o(h);r(h),r(b),V(()=>O($,`${e(n),y(()=>e(n).languageCount)??""} of your choice`)),w(k,b)};M(j,k=>{e(n),y(()=>e(n).languageCount)&&k(E)})}var S=l(j,2);{var L=k=>{var b=Le(),h=l(o(b),2),$=o(h,!0);r(h),r(b),V(U=>O($,U),[()=>(e(n),y(()=>e(n).toolProficiencies.join(", ")))]),w(k,b)};M(S,k=>{e(n),y(()=>e(n).toolProficiencies&&e(n).toolProficiencies.length>0)&&k(L)})}var N=l(S,2),ee=l(o(N),2);J(ee,5,()=>(e(n),y(()=>e(n).equipment)),Q,(k,b)=>{var h=Ne(),$=o(h,!0);r(h),V(()=>O($,e(b))),w(k,h)}),r(ee),r(N),r(u);var ge=l(u,2);J(ge,1,()=>(e(n),y(()=>e(n).backgroundFeatures)),Q,(k,b)=>{var h=De(),$=o(h),U=o($,!0);r($);var ae=l($,2),ke=o(ae);we(ke,()=>(e(b),y(()=>e(b).description))),r(ae),r(h),V(()=>O(U,(e(b),y(()=>e(b).name)))),w(k,h)}),r(t);var te=l(t,2),se=o(te),be=l(se,2);r(te),r(d),r(i),V(k=>{O(_,(e(n),y(()=>e(n).name))),O(P,(e(n),y(()=>e(n).description))),O(C,k)},[()=>(e(n),y(()=>e(n).skillProficiencies.join(", ")))]),D("click",f,()=>m(n,null)),D("click",se,()=>m(n,null)),D("click",be,ue),w(s,i)};M(I,s=>{e(n)&&s(me)})}var ye=l(I,2);{var _e=s=>{var i=Re(),d=o(i),a=o(d),f=l(a,2),t=o(f),c=o(t,!0);r(t);var _=l(t,2),g=o(_,!0);r(_),r(f);var P=l(f,2);r(d);var u=l(d,2);Ae(u,{get features(){return e(q)},get selectionVersion(){return e(W)},get characterStore(){return z},onBumpVersion:()=>Pe(W),get featureSelections(){return e(p)},set featureSelections(F){m(p,F)},get expandedFeatures(){return e(K)},set expandedFeatures(F){m(K,F)},$$legacy:!0}),r(i),V(()=>{R(a,"src",(e(v),y(()=>e(v).image))),R(a,"alt",(e(v),y(()=>`${e(v).name} icon`))),O(c,(e(v),y(()=>e(v).name))),O(g,(e(v),y(()=>e(v).description)))}),D("click",P,de),w(s,i)};M(ye,s=>{e(v)&&s(_e)})}r(T),w(ie,T),Oe()}export{tt as component};
