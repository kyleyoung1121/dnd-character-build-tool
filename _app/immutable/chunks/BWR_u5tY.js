import"./DsnmJJEf.js";import"./69_IOA4Y.js";import{l as ue,X as he,aZ as Ge,a_ as Ye,aW as Ze,W as ze,a8 as Ke,$ as Xe,av as Je,as as Qe,a2 as ye,aI as et,aA as tt,aj as ee,c as at,a$ as nt,aa as st,ac as rt,aT as ot,aS as it,Z as $e,ae as ct,Y as lt,a3 as fe,x as ke,af as ae,s as J,ah as Q,a7 as v,a as r,ag as Fe,y as j,C as N,B as M,E as k,u as _,z as O,A as Ce,am as z,aM as Ee,al as ce,aK as ft}from"./BPQ4JWg8.js";import{e as ie,i as qe}from"./CDrqGHx5.js";import{i as Se}from"./yjxl5BeO.js";import{p as $}from"./7_DP7i28.js";import{i as ne,s as xe,a as Oe}from"./kroobstV.js";import{g as Ie,s as te,e as be}from"./7VHg90vh.js";import{a as ge}from"./CHKTiq6q.js";import{a as Re,c as Pe}from"./C5Mm7jBH.js";import{s as ut}from"./Nh_3iQMt.js";import{s as _e}from"./_s8Gduf-.js";import{i as dt,s as vt}from"./7CfZzBoQ.js";import{g as pt}from"./BPX9IFYN.js";function Ve(c,n,p){ue&&he();var l=c,m=et,o,t,s=null,u=Ge()?Ye:Ze;function d(){o&&tt(o),s!==null&&(s.lastChild.remove(),l.before(s),s=null),o=t}ze(()=>{if(u(m,m=n())){var e=l,i=Qe();i&&(s=document.createDocumentFragment(),s.append(e=Ke())),t=Xe(()=>p(e)),i?Je.add_callback(d):d()}}),ue&&(l=ye)}function mt(c,n,p=!1,l=!1,m=!1){var o=c,t="";ee(()=>{var s=at;if(t===(t=n()??"")){ue&&he();return}if(s.nodes_start!==null&&(nt(s.nodes_start,s.nodes_end),s.nodes_start=s.nodes_end=null),t!==""){if(ue){ye.data;for(var u=he(),d=u;u!==null&&(u.nodeType!==st||u.data!=="");)d=u,u=rt(u);if(u===null)throw ot(),it;$e(ye,d),o=ct(u);return}var e=t+"";p?e=`<svg>${e}</svg>`:l&&(e=`<math>${e}</math>`);var i=lt(e);if((p||l)&&(i=fe(i)),$e(fe(i),i.lastChild),p||l)for(;fe(i);)o.before(fe(i));else o.before(i)}})}function De(c,n){if(!c.featureOptions)return!1;const p=n[c.name]||[],l=c.featureOptions.numPicks||1;if(p.filter(t=>t!==null&&t!=="").length<l)return!0;const o=de(c,p);if(o.length>0){for(const t of o)if(De(t,n))return!0}return!1}function de(c,n){if(!c.featureOptions)return[];const p=[];for(const l of c.featureOptions.options){const m=typeof l=="string"?l:l.name;n.includes(m)&&typeof l!="string"&&l.nestedPrompts&&p.push(...l.nestedPrompts)}return p}function gt(c,n,p,l){const m=c.featureOptions?.options||[],o=p[c.name]||[],t=o[n]??null,s=Ie(l),u=new Set;if(Array.isArray(s.skills))for(const d of s.skills)u.add(d);if(Array.isArray(s.languages))for(const d of s.languages)u.add(d);if(Array.isArray(s.proficiencies))for(const d of s.proficiencies)u.add(d);for(const[d,e]of Object.entries(p))for(const[i,R]of(e||[]).entries())R&&(d===c.name&&i===n||u.add(R));return m.filter(d=>{const e=typeof d=="string"?d:d.name;return o.some((i,R)=>i===e&&R!==n)?!1:t===e?!0:!u.has(e)})}function _t(c,n){if(!c.featureOptions)return n;const p={...n};let l=!1;function m(o){if(p[o.name]&&(delete p[o.name],l=!0),o.featureOptions){for(const t of o.featureOptions.options)if(typeof t!="string"&&t.nestedPrompts)for(const s of t.nestedPrompts)m(s)}}for(const o of c.featureOptions.options)if(typeof o!="string"&&o.nestedPrompts)for(const t of o.nestedPrompts)m(t);return l?p:n}function ht(c){return typeof c.target=="string"&&c.target.includes("{userChoice}")||typeof c.value=="string"&&c.value.includes("{userChoice}")}var yt=j("<span><!></span>"),bt=j('<option class="svelte-or9q4d"> </option>'),kt=j('<select class="svelte-or9q4d"><option disabled class="svelte-or9q4d"> </option><!></select>'),Ct=j("<!> <!>",1),St=j('<p class="svelte-or9q4d"><!></p> <!>',1),xt=j('<div><button type="button"><span class="feature-name svelte-or9q4d"> <!></span> <span class="expand-indicator svelte-or9q4d"> </span></button> <!></div>');function Le(c,n){ke(n,!1);const[p,l]=xe(),m=()=>Oe(Re,"$activeConflicts",p),o=Q(),t=Q(),s=Q(),u=Q(),d=Q();let e=$(n,"feature",8),i=$(n,"featureSelections",8),R=$(n,"expandedFeatures",8),K=$(n,"selectionVersion",8),h=$(n,"characterStore",8),P=$(n,"nested",8,!1),W=$(n,"onSelectOption",8),a=$(n,"onToggleExpand",8);function f(y){return m().hasConflicts?m().conflicts.some(V=>V.sources.some(H=>H.includes(y))):!1}function C(y){return r(d)?e().featureOptions?"user-changeable":"automatic":"none"}function A(y){return gt(e(),y,i(),h())}function E(y,V){const H=y.target;W()(e(),V,H.value)}ae(()=>(v(R()),v(e())),()=>{J(o,R().has(e().name))}),ae(()=>(v(e()),v(i())),()=>{J(t,De(e(),i()))}),ae(()=>(r(t),v(e())),()=>{J(s,!r(t)&&e().featureOptions)}),ae(()=>(v(e()),v(i())),()=>{J(u,de(e(),i()[e().name]||[]))}),ae(()=>v(e()),()=>{J(d,f(e().name))}),Fe(),Se();var S=xt(),F=N(S);let B;var x=N(F),w=N(x),g=M(w);{var T=y=>{var V=yt();let H;var ve=N(V);{var pe=D=>{var Y=Ee("⚠️");O(D,Y)},me=D=>{var Y=Ee("ℹ️");O(D,Y)};ne(ve,D=>{v(e()),_(()=>C(e().name)==="user-changeable")?D(pe):D(me,!1)})}k(V),ee((D,Y)=>{H=_e(V,1,"conflict-badge svelte-or9q4d",null,H,D),ut(V,"title",Y)},[()=>({"user-changeable":C(e().name)==="user-changeable",automatic:C(e().name)==="automatic"}),()=>(v(e()),_(()=>C(e().name)==="user-changeable"?"You can change this selection to resolve conflicts":"This feature conflicts with your other selections"))]),O(y,V)};ne(g,y=>{r(d)&&y(T)})}k(x);var b=M(x,2),q=N(b,!0);k(b),k(F);var I=M(F,2);{var G=y=>{var V=St(),H=z(V),ve=N(H);mt(ve,()=>(v(e()),_(()=>e().description))),k(H);var pe=M(H,2);{var me=D=>{var Y=Ct(),Ne=z(Y);ie(Ne,1,()=>(v(e()),_(()=>Array(e().featureOptions.numPicks))),qe,(se,Ae,U)=>{var le=ce(),He=z(le);Ve(He,()=>(v(e()),v(K()),_(()=>`${e().name}:${U}:${K()}`)),Me=>{var Z=kt(),re=N(Z),Be=N(re,!0);k(re),re.value=re.__value="";var Ue=M(re);ie(Ue,1,()=>_(()=>A(U)),X=>typeof X=="string"?X:X.name,(X,L)=>{var oe=bt(),je=N(oe,!0);k(oe);var Te={};ee(()=>{te(je,(r(L),_(()=>typeof r(L)=="string"?r(L):r(L).name))),Te!==(Te=(r(L),_(()=>typeof r(L)=="string"?r(L):r(L).name)))&&(oe.value=(oe.__value=(r(L),_(()=>typeof r(L)=="string"?r(L):r(L).name)))??"")}),O(X,oe)}),k(Z);var we;dt(Z),ee(()=>{te(Be,(v(e()),_(()=>e().featureOptions.placeholderText||"Select an option"))),we!==(we=(v(i()),v(e()),_(()=>i()[e().name]?.[U]||"")))&&(Z.value=(Z.__value=(v(i()),v(e()),_(()=>i()[e().name]?.[U]||"")))??"",vt(Z,(v(i()),v(e()),_(()=>i()[e().name]?.[U]||""))))}),be("change",Z,X=>E(X,U)),O(Me,Z)}),O(se,le)});var We=M(Ne,2);ie(We,1,()=>r(u),se=>se.name,(se,Ae)=>{var U=ce(),le=z(U);Le(le,{get feature(){return r(Ae)},get featureSelections(){return i()},get expandedFeatures(){return R()},get selectionVersion(){return K()},get characterStore(){return h()},get onSelectOption(){return W()},get onToggleExpand(){return a()},nested:!0}),O(se,U)}),O(D,Y)};ne(pe,D=>{v(e()),_(()=>e().featureOptions)&&D(me)})}O(y,V)};ne(I,y=>{r(o)&&y(G)})}k(S),ee(y=>{_e(S,1,`feature-card ${r(t)?"incomplete":r(s)?"complete":""} ${P()?"nested":""}`,"svelte-or9q4d"),B=_e(F,1,"feature-header svelte-or9q4d",null,B,y),te(w,`${v(e()),_(()=>e().name)??""} `),te(q,r(o)?"–":"+")},[()=>({"has-conflicts":r(d)})]),be("click",F,()=>a()(e().name)),O(c,S),Ce(),l()}function Mt(c,n){ke(n,!1);const[p,l]=xe(),m=()=>Oe(Pe,"$conflicts",p);let o=$(n,"features",8),t=$(n,"featureSelections",12),s=$(n,"expandedFeatures",12),u=$(n,"selectionVersion",8),d=$(n,"characterStore",8),e=$(n,"onBumpVersion",8);function i(a,f,C){if(!C)return;const A=C,E=a.featureOptions?.numPicks||1;t()[a.name]?K(t()[a.name],E):t(t()[a.name]=Array(E).fill(null),!0);const S=t()[a.name][f],F=[...t()[a.name]];if(F[f]=A,t({...t(),[a.name]:F}),e()(),S===A)return;t(_t(a,t()));const B=`feature:${a.name}:${f}`;if(h(a,A,B,f),S){const x=de(a,[S])||[];for(const w of x){if(w.featureOptions)continue;const g=`feature:${a.name}:${f}:${w.name}`;ge(g,{})}}setTimeout(()=>{Ie(Pe)},0)}function R(a){s().has(a)?s().delete(a):s().add(a),s(new Set(s()))}function K(a,f){if(a.length<f){const C=a.length;a.length=f;for(let A=C;A<f;A++)a[A]=null}}function h(a,f,C,A){const E={},S={},F=a.effects||[];for(const x of F){if(!ht(x))continue;const w=(b,q=!1)=>{if(typeof b!="string")return b;let I=b.replace(/\{userChoice\}/g,f);return q&&(I=I.toLowerCase().replace(/\s+/g,"_")),I},g=w(x.target,!0),T=w(x.value);switch(x.action){case"add":{const b=Array.isArray(T)?T:[T];E[g]||(E[g]=[]),E[g].push(...b);break}case"set":{E[g]=T;break}case"modify":{const b=Number(T);isNaN(b)||(S[g]=(S[g]??0)+b);break}}}ge(C,E,S);const B=de(a,[f])||[];for(const x of B){if(x.featureOptions)continue;const w=`feature:${a.name}:${A}:${x.name}`,g={},T={};for(const b of x.effects||[]){const q=b.target,I=b.value;switch(b.action){case"add":{const G=Array.isArray(I)?I:[I];g[q]||(g[q]=[]),g[q].push(...G);break}case"set":{g[q]=I;break}case"modify":{const G=Number(I);isNaN(G)||(T[q]=(T[q]??0)+G);break}}}ge(w,g,T)}}Se();var P=ce(),W=z(P);ie(W,1,o,a=>a.name,(a,f)=>{var C=ce(),A=z(C);Ve(A,()=>(r(f),v(u()),m(),_(()=>`${r(f).name}:${u()}:${m().hasConflicts}`)),E=>{Le(E,{get feature(){return r(f)},get featureSelections(){return t()},get expandedFeatures(){return s()},get selectionVersion(){return u()},get characterStore(){return d()},onSelectOption:i,onToggleExpand:R})}),O(a,C)}),O(c,P),Ce(),l()}var Ot=j('<div class="conflict-item svelte-1ddlxke"><div class="conflict-description svelte-1ddlxke"> </div> <div class="conflict-resolution svelte-1ddlxke"><strong>Resolution:</strong> </div></div>'),Nt=j('<div class="conflicts-list svelte-1ddlxke"></div> <div class="guidance-section svelte-1ddlxke"><p class="svelte-1ddlxke">Go to the highlighted tabs and make different selections to avoid duplicates.</p></div>',1),At=j('<div class="conflict-warning-container svelte-1ddlxke"><div class="conflict-warning svelte-1ddlxke"><button class="warning-header svelte-1ddlxke"><div class="header-content svelte-1ddlxke"><span class="warning-icon svelte-1ddlxke">⚠️</span> <h3 class="svelte-1ddlxke">Conflicts Detected</h3></div> <span class="expand-indicator svelte-1ddlxke"> </span></button> <!></div></div>');function Bt(c,n){ke(n,!1);const[p,l]=xe(),m=()=>Oe(Re,"$activeConflicts",p),o=Q();let t=$(n,"tabName",8,""),s=Q(!1);function u(){J(s,!r(s))}function d(h){const W={skill:"Skill",proficiency:"Proficiency",language:"Language",feature:"Feature"}[h.type]||h.type,a=h.sources.map(f=>f.startsWith("bard.")?"Bard class":f.startsWith("high_elf.")?"High Elf race":f.startsWith("hill_dwarf.")?"Hill Dwarf race":f.startsWith("fighter.")?"Fighter class":f);return`${W} "${h.value}" is granted by multiple sources: ${a.join(", ")}`}function e(h){const P=pt(h);return P?`Go to the ${P.charAt(0).toUpperCase()+P.slice(1)} tab and select a different ${h.type} to resolve this conflict.`:"This conflict involves automatic grants. Consider changing your other selections."}ae(()=>(m(),v(t())),()=>{J(o,m().conflicts.filter(h=>h.affectedTabs?.includes(t())??!1))}),Fe(),Se();var i=ce(),R=z(i);{var K=h=>{var P=At(),W=N(P),a=N(W),f=M(N(a),2),C=N(f,!0);k(f),k(a);var A=M(a,2);{var E=S=>{var F=Nt(),B=z(F);ie(B,5,()=>r(o),qe,(x,w)=>{var g=Ot(),T=N(g),b=N(T,!0);k(T);var q=M(T,2),I=M(N(q));k(q),k(g),ee((G,y)=>{te(b,G),te(I,` ${y??""}`)},[()=>(r(w),_(()=>d(r(w)))),()=>(r(w),_(()=>e(r(w))))]),O(x,g)}),k(B),ft(2),O(S,F)};ne(A,S=>{r(s)&&S(E)})}k(W),k(P),ee(()=>te(C,r(s)?"−":"+")),be("click",a,u),O(h,P)};ne(R,h=>{r(o),_(()=>r(o).length>0)&&h(K)})}O(c,i),Ce(),l()}export{Bt as C,Mt as F,ht as e,mt as h,De as i};
