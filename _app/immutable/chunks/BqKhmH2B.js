import"./DsnmJJEf.js";import"./ZZTCqOQ3.js";import{h as fe,C as he,aR as je,aS as qe,aT as Ge,z as Je,y as Me,O as We,U as Ye,Q as Ke,J as ye,aL as Qe,_ as Ze,aG as te,k as Xe,aU as et,K as tt,a4 as at,aV as nt,aW as st,at as Ce,A as rt,as as ot,B as oe,a8 as Pe,aD as Z,j as X,W as ee,az as m,d as i,aE as ct,a9 as M,ad as U,ac as G,ae as z,u as h,aa as w,ab as we,aJ as J,aO as Ae,aI as ue}from"./DOIzd24M.js";import{e as le,i as it}from"./CgRNHZ8z.js";import{i as Ee}from"./BzeKlRg4.js";import{p as S}from"./D_cKxHmv.js";import{i as ce,s as Fe,a as Ie}from"./AuiCrjz8.js";import{g as Ve,s as ie,e as Ne}from"./GyQv_478.js";import{a as _e}from"./CiCzU4bx.js";import{a as lt,c as Te}from"./DIrBWaNV.js";import{s as ft}from"./BZac2UBV.js";import{s as ge}from"./B-x1kW5-.js";import{i as ut,s as mt}from"./L01jigut.js";function xe(c,a,d){fe&&he();var l=c,v=Qe,o,t,s=null,f=je()?qe:Ge;function u(){o&&Ze(o),s!==null&&(s.lastChild.remove(),l.before(s),s=null),o=t}Je(()=>{if(f(v,v=a())){var e=l,r=Ke();r&&(s=document.createDocumentFragment(),s.append(e=Me())),t=We(()=>d(e)),r?Ye.add_callback(u):u()}}),fe&&(l=ye)}function dt(c,a,d=!1,l=!1,v=!1){var o=c,t="";te(()=>{var s=Xe;if(t===(t=a()??"")){fe&&he();return}if(s.nodes_start!==null&&(et(s.nodes_start,s.nodes_end),s.nodes_start=s.nodes_end=null),t!==""){if(fe){ye.data;for(var f=he(),u=f;f!==null&&(f.nodeType!==tt||f.data!=="");)u=f,f=at(f);if(f===null)throw nt(),st;Ce(ye,u),o=rt(f);return}var e=t+"";d?e=`<svg>${e}</svg>`:l&&(e=`<math>${e}</math>`);var r=ot(e);if((d||l)&&(r=oe(r)),Ce(oe(r),r.lastChild),d||l)for(;oe(r);)o.before(oe(r));else o.before(r)}})}function Re(c,a){if(!c.featureOptions)return!1;const d=a[c.name]||[],l=c.featureOptions.numPicks||1;if(d.filter(t=>t!==null&&t!=="").length<l)return!0;const o=me(c,d);if(o.length>0){for(const t of o)if(Re(t,a))return!0}return!1}function me(c,a){if(!c.featureOptions)return[];const d=[];for(const l of c.featureOptions.options){const v=typeof l=="string"?l:l.name;a.includes(v)&&typeof l!="string"&&l.nestedPrompts&&d.push(...l.nestedPrompts)}return d}function pt(c,a,d,l){const v=c.featureOptions?.options||[],o=d[c.name]||[],t=o[a]??null,s=Ve(l),f=new Set;if(Array.isArray(s.skills))for(const u of s.skills)f.add(u);if(Array.isArray(s.languages))for(const u of s.languages)f.add(u);if(Array.isArray(s.proficiencies))for(const u of s.proficiencies)f.add(u);for(const[u,e]of Object.entries(d))for(const[r,I]of(e||[]).entries())I&&(u===c.name&&r===a||f.add(I));return v.filter(u=>{const e=typeof u=="string"?u:u.name;return o.some((r,I)=>r===e&&I!==a)?!1:t===e?!0:!f.has(e)})}function vt(c,a){if(!c.featureOptions)return a;const d={...a};let l=!1;function v(o){if(d[o.name]&&(delete d[o.name],l=!0),o.featureOptions){for(const t of o.featureOptions.options)if(typeof t!="string"&&t.nestedPrompts)for(const s of t.nestedPrompts)v(s)}}for(const o of c.featureOptions.options)if(typeof o!="string"&&o.nestedPrompts)for(const t of o.nestedPrompts)v(t);return l?d:a}function _t(c){return typeof c.target=="string"&&c.target.includes("{userChoice}")||typeof c.value=="string"&&c.value.includes("{userChoice}")}var gt=M("<span><!></span>"),ht=M('<option class="svelte-1cl69m0"> </option>'),yt=M('<select class="svelte-1cl69m0"><option disabled class="svelte-1cl69m0"> </option><!></select>'),bt=M("<!> <!>",1),Ot=M('<p class="svelte-1cl69m0"><!></p> <!>',1),St=M('<div><button type="button"><span class="feature-name svelte-1cl69m0"> <!></span> <span class="expand-indicator svelte-1cl69m0"> </span></button> <!></div>');function Le(c,a){Pe(a,!1);const[d,l]=Fe(),v=()=>Ie(lt,"$activeConflicts",d),o=ee(),t=ee(),s=ee(),f=ee(),u=ee();let e=S(a,"feature",8),r=S(a,"featureSelections",8),I=S(a,"expandedFeatures",8),W=S(a,"selectionVersion",8),ae=S(a,"characterStore",8),ne=S(a,"nested",8,!1),se=S(a,"onSelectOption",8),n=S(a,"onToggleExpand",8);function p(g){return v().hasConflicts?v().conflicts.some(N=>N.sources.some(L=>L.includes(g))):!1}function b(g){return i(u)?e().featureOptions?"user-changeable":"automatic":"none"}function k(g){return pt(e(),g,r(),ae())}function C(g,N){const L=g.target;se()(e(),N,L.value)}Z(()=>(m(I()),m(e())),()=>{X(o,I().has(e().name))}),Z(()=>(m(e()),m(r())),()=>{X(t,Re(e(),r()))}),Z(()=>(i(t),m(e())),()=>{X(s,!i(t)&&e().featureOptions)}),Z(()=>(m(e()),m(r())),()=>{X(f,me(e(),r()[e().name]||[]))}),Z(()=>m(e()),()=>{X(u,p(e().name))}),ct(),Ee();var A=St(),V=U(A);let j;var O=U(V),x=U(O),_=G(x);{var E=g=>{var N=gt();let L;var de=U(N);{var pe=T=>{var B=Ae("âš ï¸");w(T,B)},ve=T=>{var B=Ae("ðŸ”’");w(T,B)};ce(de,T=>{m(e()),h(()=>b(e().name)==="user-changeable")?T(pe):T(ve,!1)})}z(N),te((T,B)=>{L=ge(N,1,"conflict-badge svelte-1cl69m0",null,L,T),ft(N,"title",B)},[()=>({"user-changeable":b(e().name)==="user-changeable",automatic:b(e().name)==="automatic"}),()=>(m(e()),h(()=>b(e().name)==="user-changeable"?"You can change this selection to resolve conflicts":"This feature conflicts with your other selections, but has no alternative options"))]),w(g,N)};ce(_,g=>{i(u)&&g(E)})}z(O);var y=G(O,2),R=U(y,!0);z(y),z(V);var F=G(V,2);{var q=g=>{var N=Ot(),L=J(N),de=U(L);dt(de,()=>(m(e()),h(()=>e().description))),z(L);var pe=G(L,2);{var ve=T=>{var B=bt(),be=J(B);le(be,1,()=>(m(e()),h(()=>Array(e().featureOptions.numPicks))),it,(Y,Oe,D)=>{var re=ue(),Ue=J(re);xe(Ue,()=>(m(e()),m(W()),h(()=>`${e().name}:${D}:${W()}`)),ze=>{var H=yt(),K=U(H),Be=U(K,!0);z(K),K.value=K.__value="";var He=G(K);le(He,1,()=>h(()=>k(D)),$=>typeof $=="string"?$:$.name,($,P)=>{var Q=ht(),$e=U(Q,!0);z(Q);var ke={};te(()=>{ie($e,(i(P),h(()=>typeof i(P)=="string"?i(P):i(P).name))),ke!==(ke=(i(P),h(()=>typeof i(P)=="string"?i(P):i(P).name)))&&(Q.value=(Q.__value=(i(P),h(()=>typeof i(P)=="string"?i(P):i(P).name)))??"")}),w($,Q)}),z(H);var Se;ut(H),te(()=>{ie(Be,(m(e()),h(()=>e().featureOptions.placeholderText||"Select an option"))),Se!==(Se=(m(r()),m(e()),h(()=>r()[e().name]?.[D]||"")))&&(H.value=(H.__value=(m(r()),m(e()),h(()=>r()[e().name]?.[D]||"")))??"",mt(H,(m(r()),m(e()),h(()=>r()[e().name]?.[D]||""))))}),Ne("change",H,$=>C($,D)),w(ze,H)}),w(Y,re)});var De=G(be,2);le(De,1,()=>i(f),Y=>Y.name,(Y,Oe)=>{var D=ue(),re=J(D);Le(re,{get feature(){return i(Oe)},get featureSelections(){return r()},get expandedFeatures(){return I()},get selectionVersion(){return W()},get characterStore(){return ae()},get onSelectOption(){return se()},get onToggleExpand(){return n()},nested:!0}),w(Y,D)}),w(T,B)};ce(pe,T=>{m(e()),h(()=>e().featureOptions)&&T(ve)})}w(g,N)};ce(F,g=>{i(o)&&g(q)})}z(A),te(g=>{ge(A,1,`feature-card ${i(t)?"incomplete":i(s)?"complete":""} ${ne()?"nested":""}`,"svelte-1cl69m0"),j=ge(V,1,"feature-header svelte-1cl69m0",null,j,g),ie(x,`${m(e()),h(()=>e().name)??""} `),ie(R,i(o)?"â€“":"+")},[()=>({"has-conflicts":i(u)})]),Ne("click",V,()=>n()(e().name)),w(c,A),we(),l()}function Lt(c,a){Pe(a,!1);const[d,l]=Fe(),v=()=>Ie(Te,"$conflicts",d);let o=S(a,"features",8),t=S(a,"featureSelections",12),s=S(a,"expandedFeatures",12),f=S(a,"selectionVersion",8),u=S(a,"characterStore",8),e=S(a,"onBumpVersion",8);function r(n,p,b){if(!b)return;const k=b,C=n.featureOptions?.numPicks||1;t()[n.name]?W(t()[n.name],C):t(t()[n.name]=Array(C).fill(null),!0);const A=t()[n.name][p],V=[...t()[n.name]];if(V[p]=k,t({...t(),[n.name]:V}),e()(),A===k)return;t(vt(n,t()));const j=`feature:${n.name}:${p}`;if(ae(n,k,j,p),A){const O=me(n,[A])||[];for(const x of O){if(x.featureOptions)continue;const _=`feature:${n.name}:${p}:${x.name}`;_e(_,{})}}setTimeout(()=>{Ve(Te)},0)}function I(n){s().has(n)?s().delete(n):s().add(n),s(new Set(s()))}function W(n,p){if(n.length<p){const b=n.length;n.length=p;for(let k=b;k<p;k++)n[k]=null}}function ae(n,p,b,k){const C={},A={},V=n.effects||[];for(const O of V){if(!_t(O))continue;const x=(y,R=!1)=>{if(typeof y!="string")return y;let F=y.replace(/\{userChoice\}/g,p);return R&&(F=F.toLowerCase().replace(/\s+/g,"_")),F},_=x(O.target,!0),E=x(O.value);switch(O.action){case"add":{const y=Array.isArray(E)?E:[E];C[_]||(C[_]=[]),C[_].push(...y);break}case"set":{C[_]=E;break}case"modify":{const y=Number(E);isNaN(y)||(A[_]=(A[_]??0)+y);break}}}_e(b,C,A);const j=me(n,[p])||[];for(const O of j){if(O.featureOptions)continue;const x=`feature:${n.name}:${k}:${O.name}`,_={},E={};for(const y of O.effects||[]){const R=y.target,F=y.value;switch(y.action){case"add":{const q=Array.isArray(F)?F:[F];_[R]||(_[R]=[]),_[R].push(...q);break}case"set":{_[R]=F;break}case"modify":{const q=Number(F);isNaN(q)||(E[R]=(E[R]??0)+q);break}}}_e(x,_,E)}}Ee();var ne=ue(),se=J(ne);le(se,1,o,n=>n.name,(n,p)=>{var b=ue(),k=J(b);xe(k,()=>(i(p),m(f()),v(),h(()=>`${i(p).name}:${f()}:${v().hasConflicts}`)),C=>{Le(C,{get feature(){return i(p)},get featureSelections(){return t()},get expandedFeatures(){return s()},get selectionVersion(){return f()},get characterStore(){return u()},onSelectOption:r,onToggleExpand:I})}),w(n,b)}),w(c,ne),we(),l()}export{Lt as F,_t as e,dt as h,Re as i};
