import"../chunks/DsnmJJEf.js";import"../chunks/CQMj6I71.js";import{o as ke}from"../chunks/CWh0W3WP.js";import{y as qe,ah as re,ai as ye,z as $,A as C,B as xe,d as e,j as m,aj as A,ak as Y,E as o,C as l,F as r,al as S,v as h,am as Fe}from"../chunks/D8epjS11.js";import{g as H,s as x,e as L}from"../chunks/BiH1rH3r.js";import{i as N}from"../chunks/DNOeg3kL.js";import{e as J,i as Q}from"../chunks/Cf40ah7q.js";import{C as Oe,h as Pe}from"../chunks/B9K-xhhX.js";import{s as D}from"../chunks/Dmswp-gS.js";import{i as Ce}from"../chunks/nRLFwT7N.js";import{b as $e}from"../chunks/BPjcew-M.js";import{i as we,F as Ae}from"../chunks/C5adfhwt.js";import{b as oe}from"../chunks/C7JnBEaE.js";import{a as ne,r as ie}from"../chunks/CFTOOR2V.js";import{c as W}from"../chunks/DANXc4Na.js";var Se=$('<button class="background-card svelte-zhu2zq"><div class="card-left svelte-zhu2zq"><img class="svelte-zhu2zq"/> <span> </span></div> <img class="card-arrow svelte-zhu2zq" alt="next arrow"/></button>'),Be=$('<div class="background-cards svelte-zhu2zq"></div>'),je=$('<div class="detail-section svelte-zhu2zq"><h4 class="svelte-zhu2zq">Languages</h4> <p class="svelte-zhu2zq"> </p></div>'),Ve=$('<div class="detail-section svelte-zhu2zq"><h4 class="svelte-zhu2zq">Tool Proficiencies</h4> <p class="svelte-zhu2zq"> </p></div>'),Ee=$("<li> </li>"),Le=$('<div class="feature-card svelte-zhu2zq"><h4 class="svelte-zhu2zq"> </h4> <p class="svelte-zhu2zq"><!></p></div>'),Ne=$('<div class="popup svelte-zhu2zq"><div class="popup-content svelte-zhu2zq"><div class="popup-header svelte-zhu2zq"><span>CONFIRM ADD BACKGROUND</span> <button class="close-button svelte-zhu2zq">×</button></div> <div class="popup-body svelte-zhu2zq"><h2> </h2> <p class="description svelte-zhu2zq"> </p> <div class="background-details svelte-zhu2zq"><div class="detail-section svelte-zhu2zq"><h4 class="svelte-zhu2zq">Skill Proficiencies</h4> <p class="svelte-zhu2zq"> </p></div> <!> <!> <div class="detail-section svelte-zhu2zq"><h4 class="svelte-zhu2zq">Equipment</h4> <ul class="svelte-zhu2zq"></ul></div></div> <!></div> <div class="popup-footer svelte-zhu2zq"><button class="cancel-button svelte-zhu2zq">Cancel</button> <button class="add-button svelte-zhu2zq">Add Background</button></div></div></div>'),De=$('<div class="selected-background-card svelte-zhu2zq"><div class="selected-background-info svelte-zhu2zq"><img class="selected-background-icon svelte-zhu2zq"/> <div class="selected-background-text svelte-zhu2zq"><h2 class="svelte-zhu2zq"> </h2> <p class="description svelte-zhu2zq"> </p></div> <button class="remove-background-button svelte-zhu2zq" aria-label="Remove selected background">✕</button></div> <!></div>'),Me=$(`<div class="main-content svelte-zhu2zq"><!> <p class="intro-text svelte-zhu2zq">Your character's background reveals where you came from, how you became an adventurer, and your
		place in the world. Backgrounds provide skill proficiencies, languages, equipment, and special
		features that reflect your past experiences.</p> <!> <!> <!></div>`);function st(ce,le){qe(le,!1);const M=A(),ue=A();let n=A(null),u=A(null),p=A({}),R=A(new Set),K=A(0);function G(){m(K,(e(K)+1)%1e6)}function ve(){if(e(u)){let v=function(t){const i=[];for(const z of t)if(i.push(z.name),z.featureOptions)for(const _ of z.featureOptions.options)typeof _!="string"&&_.nestedPrompts&&i.push(...v(_.nestedPrompts));return i};const s=H(W),c=Object.keys(s._provenance||{}),a=v(e(u).backgroundFeatures||[]),f=[`background:${e(u).name}`,...a.map(t=>`feature:${t}`)];for(const t of c)f.some(i=>t.startsWith(i))&&ie(s,t)}m(u,null),m(n,null),m(p,{}),m(R,new Set),G()}function de(){if(e(n)){m(u,e(n)),m(n,null),m(p,{}),m(R,new Set),ne(`background:${e(u).name}`,{background:e(u).name});for(const s of e(u).backgroundFeatures||[]){if(s.featureOptions)continue;const c=`feature:${s.name}`;ie(H(W),c);const v={},a={};for(const f of s.effects||[]){const t=f.target,i=f.value;switch(f.action){case"add":{const z=Array.isArray(i)?i:[i];v[t]||(v[t]=[]),v[t].push(...z);break}case"set":{v[t]=i;break}case"modify":{a[t]=(a[t]||0)+i;break}}}(Object.keys(v).length>0||Object.keys(a).length>0)&&ne(c,v,a)}for(const s of e(u).backgroundFeatures||[])if(s.featureOptions){const c=s.featureOptions.numPicks;Y(p,e(p)[s.name]=new Array(c).fill(null))}G()}}function pe(s,c){if(s.length<c){const v=s.length;s.length=c;for(let a=v;a<c;a++)s[a]=null}}ke(()=>{const s=H(W);if(!s.background)return;const c=oe.find(t=>t.name===s.background);if(!c)return;m(u,c),m(p,{});const v=t=>t.toLowerCase().replace(/\s+/g,"_"),a=(t,i)=>{const z=v(t);for(const[_,F]of i.entries())if(z.includes(_))return F;return null},f=t=>{const i=t.featureOptions?.numPicks||1;e(p)[t.name]?pe(e(p)[t.name],i):Y(p,e(p)[t.name]=Array(i).fill(null));const z=t.featureOptions?.options||[],_=new Map(z.map(d=>[v(typeof d=="string"?d:d.name),typeof d=="string"?d:d.name])),F=s._provenance||{};for(let d=0;d<i;d++){if(e(p)[t.name][d])continue;const y=`feature:${t.name}:${d}`,q=F[y];let O=null;if(q?._set)for(const B of t.effects||[]){const j=B.target,w=q._set[j];if(Array.isArray(w))for(const V of w){const E=a(V,_);if(E){O=E;break}}else if(typeof w=="string"){const V=a(w,_);V&&(O=V)}if(O)break}if(!O&&q?._mods)for(const B of Object.keys(q._mods)){const j=a(B,_);if(j){O=j;break}}O&&Y(p,e(p)[t.name][d]=O)}t.featureOptions?.options&&t.featureOptions.options.forEach(d=>{typeof d!="string"&&d.nestedPrompts&&e(p)[t.name].find(q=>q===d.name)&&d.nestedPrompts.forEach(q=>f(q))})};c.backgroundFeatures?.forEach(t=>f(t)),m(p,{...e(p)}),G()}),re(()=>e(u),()=>{m(M,e(u)?[...e(u).backgroundFeatures||[]]:[])}),re(()=>(e(M),e(p)),()=>{m(ue,e(M).map(s=>({feature:s,incomplete:we(s,e(p))})))}),ye(),Ce();var T=Me(),X=o(T);Oe(X,{tabName:"background"});var Z=l(X,4);{var fe=s=>{var c=Be();J(c,5,()=>oe,Q,(v,a)=>{var f=Se(),t=o(f),i=o(t),z=l(i,2),_=o(z,!0);r(z),r(t);var F=l(t,2);r(f),S(()=>{D(i,"src",(e(a),h(()=>e(a).image))),D(i,"alt",(e(a),h(()=>`${e(a).name} icon`))),x(_,(e(a),h(()=>e(a).name))),D(F,"src",`${$e??""}/basic_icons/blue_next.png`)}),L("click",f,()=>m(n,e(a))),C(v,f)}),r(c),C(s,c)};N(Z,s=>{e(u)||s(fe)})}var I=l(Z,2);{var me=s=>{var c=Ne(),v=o(c),a=o(v),f=l(o(a),2);r(a);var t=l(a,2),i=o(t),z=o(i,!0);r(i);var _=l(i,2),F=o(_,!0);r(_);var d=l(_,2),y=o(d),q=l(o(y),2),O=o(q,!0);r(q),r(y);var B=l(y,2);{var j=b=>{var g=je(),k=l(o(g),2),P=o(k);r(k),r(g),S(()=>x(P,`${e(n),h(()=>e(n).languageCount)??""} of your choice`)),C(b,g)};N(B,b=>{e(n),h(()=>e(n).languageCount)&&b(j)})}var w=l(B,2);{var V=b=>{var g=Ve(),k=l(o(g),2),P=o(k,!0);r(k),r(g),S(U=>x(P,U),[()=>(e(n),h(()=>e(n).toolProficiencies.join(", ")))]),C(b,g)};N(w,b=>{e(n),h(()=>e(n).toolProficiencies&&e(n).toolProficiencies.length>0)&&b(V)})}var E=l(w,2),ee=l(o(E),2);J(ee,5,()=>(e(n),h(()=>e(n).equipment)),Q,(b,g)=>{var k=Ee(),P=o(k,!0);r(k),S(()=>x(P,e(g))),C(b,k)}),r(ee),r(E),r(d);var _e=l(d,2);J(_e,1,()=>(e(n),h(()=>e(n).backgroundFeatures)),Q,(b,g)=>{var k=Le(),P=o(k),U=o(P,!0);r(P);var ae=l(P,2),be=o(ae);Pe(be,()=>(e(g),h(()=>e(g).description))),r(ae),r(k),S(()=>x(U,(e(g),h(()=>e(g).name)))),C(b,k)}),r(t);var te=l(t,2),se=o(te),ge=l(se,2);r(te),r(v),r(c),S(b=>{x(z,(e(n),h(()=>e(n).name))),x(F,(e(n),h(()=>e(n).description))),x(O,b)},[()=>(e(n),h(()=>e(n).skillProficiencies.join(", ")))]),L("click",f,()=>m(n,null)),L("click",se,()=>m(n,null)),L("click",ge,de),C(s,c)};N(I,s=>{e(n)&&s(me)})}var he=l(I,2);{var ze=s=>{var c=De(),v=o(c),a=o(v),f=l(a,2),t=o(f),i=o(t,!0);r(t);var z=l(t,2),_=o(z,!0);r(z),r(f);var F=l(f,2);r(v);var d=l(v,2);Ae(d,{get features(){return e(M)},get selectionVersion(){return e(K)},get characterStore(){return W},onBumpVersion:()=>Fe(K),get featureSelections(){return e(p)},set featureSelections(y){m(p,y)},get expandedFeatures(){return e(R)},set expandedFeatures(y){m(R,y)},$$legacy:!0}),r(c),S(()=>{D(a,"src",(e(u),h(()=>e(u).image))),D(a,"alt",(e(u),h(()=>`${e(u).name} icon`))),x(i,(e(u),h(()=>e(u).name))),x(_,(e(u),h(()=>e(u).description)))}),L("click",F,ve),C(s,c)};N(he,s=>{e(u)&&s(ze)})}r(T),C(ce,T),xe()}export{st as component};
