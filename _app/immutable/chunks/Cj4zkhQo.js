import"./DsnmJJEf.js";import"./69_IOA4Y.js";import{h as ue,k as _e,aX as je,aY as Be,aS as Ze,d as Xe,c as ze,u as Ke,y as Je,v as Qe,p as ye,V as et,G as tt,at as ee,T as at,aZ as nt,C as st,P as rt,aP as ot,aO as it,ag as xe,f as ct,af as lt,j as fe,W as Ce,ap as ae,ar as J,A as Q,al as v,l as r,aq as Fe,X as Y,$ as w,_ as G,a0 as C,a7 as h,Y as N,Z as Se,aw as X,aW as $e,av as ce,aK as ft}from"./BOKL8LPc.js";import{e as ie,i as qe}from"./DK8oEai0.js";import{i as ke}from"./DDng5zeD.js";import{p as x,s as Oe,a as Ne}from"./BxB93vFd.js";import{g as Ie,s as te,e as be}from"./BGP3eZCr.js";import{a as ge}from"./CERfiCyH.js";import{s as he,a as Ve,c as Ee}from"./CXbRCOBb.js";import{i as ne}from"./BgoevHwW.js";import{s as ut}from"./Dx3zq8i6.js";import{i as dt,s as vt}from"./By06J7I7.js";import{g as pt}from"./vVnGiSbc.js";function Re(c,n,p){ue&&_e();var l=c,m=et,o,t,s=null,u=je()?Be:Ze;function d(){o&&tt(o),s!==null&&(s.lastChild.remove(),l.before(s),s=null),o=t}Xe(()=>{if(u(m,m=n())){var e=l,i=Qe();i&&(s=document.createDocumentFragment(),s.append(e=ze())),t=Ke(()=>p(e)),i?Je.add_callback(d):d()}}),ue&&(l=ye)}function mt(c,n,p=!1,l=!1,m=!1){var o=c,t="";ee(()=>{var s=at;if(t===(t=n()??"")){ue&&_e();return}if(s.nodes_start!==null&&(nt(s.nodes_start,s.nodes_end),s.nodes_start=s.nodes_end=null),t!==""){if(ue){ye.data;for(var u=_e(),d=u;u!==null&&(u.nodeType!==st||u.data!=="");)d=u,u=rt(u);if(u===null)throw ot(),it;xe(ye,d),o=ct(u);return}var e=t+"";p?e=`<svg>${e}</svg>`:l&&(e=`<math>${e}</math>`);var i=lt(e);if((p||l)&&(i=fe(i)),xe(fe(i),i.lastChild),p||l)for(;fe(i);)o.before(fe(i));else o.before(i)}})}function De(c,n){if(!c.featureOptions)return!1;const p=n[c.name]||[],l=c.featureOptions.numPicks||1;if(p.filter(t=>t!==null&&t!=="").length<l)return!0;const o=de(c,p);if(o.length>0){for(const t of o)if(De(t,n))return!0}return!1}function de(c,n){if(!c.featureOptions)return[];const p=[];for(const l of c.featureOptions.options){const m=typeof l=="string"?l:l.name;n.includes(m)&&typeof l!="string"&&l.nestedPrompts&&p.push(...l.nestedPrompts)}return p}function gt(c,n,p,l){const m=c.featureOptions?.options||[],o=p[c.name]||[],t=o[n]??null,s=Ie(l),u=new Set;if(Array.isArray(s.skills))for(const d of s.skills)u.add(d);if(Array.isArray(s.languages))for(const d of s.languages)u.add(d);if(Array.isArray(s.proficiencies))for(const d of s.proficiencies)u.add(d);for(const[d,e]of Object.entries(p))for(const[i,V]of(e||[]).entries())V&&(d===c.name&&i===n||u.add(V));return m.filter(d=>{const e=typeof d=="string"?d:d.name;return o.some((i,V)=>i===e&&V!==n)?!1:t===e?!0:!u.has(e)})}function ht(c,n){if(!c.featureOptions)return n;const p={...n};let l=!1;function m(o){if(p[o.name]&&(delete p[o.name],l=!0),o.featureOptions){for(const t of o.featureOptions.options)if(typeof t!="string"&&t.nestedPrompts)for(const s of t.nestedPrompts)m(s)}}for(const o of c.featureOptions.options)if(typeof o!="string"&&o.nestedPrompts)for(const t of o.nestedPrompts)m(t);return l?p:n}function _t(c){return typeof c.target=="string"&&c.target.includes("{userChoice}")||typeof c.value=="string"&&c.value.includes("{userChoice}")}var yt=Y("<span><!></span>"),bt=Y('<option class="svelte-1q8hvhi"> </option>'),Ct=Y('<select class="svelte-1q8hvhi"><option disabled class="svelte-1q8hvhi"> </option><!></select>'),St=Y("<!> <!>",1),kt=Y('<p class="svelte-1q8hvhi"><!></p> <!>',1),Ot=Y('<div><button type="button"><span class="feature-name svelte-1q8hvhi"> <!></span> <span class="expand-indicator svelte-1q8hvhi"> </span></button> <!></div>');function Le(c,n){Ce(n,!1);const[p,l]=Oe(),m=()=>Ne(Ve,"$activeConflicts",p),o=Q(),t=Q(),s=Q(),u=Q(),d=Q();let e=x(n,"feature",8),i=x(n,"featureSelections",8),V=x(n,"expandedFeatures",8),z=x(n,"selectionVersion",8),_=x(n,"characterStore",8),E=x(n,"nested",8,!1),W=x(n,"onSelectOption",8),a=x(n,"onToggleExpand",8);function f(y){return m().hasConflicts?m().conflicts.some(R=>R.sources.some(H=>H.includes(y))):!1}function S(y){return r(d)?e().featureOptions?"user-changeable":"automatic":"none"}function A(y){return gt(e(),y,i(),_())}function $(y,R){const H=y.target;W()(e(),R,H.value)}ae(()=>(v(V()),v(e())),()=>{J(o,V().has(e().name))}),ae(()=>(v(e()),v(i())),()=>{J(t,De(e(),i()))}),ae(()=>(r(t),v(e())),()=>{J(s,!r(t)&&e().featureOptions)}),ae(()=>(v(e()),v(i())),()=>{J(u,de(e(),i()[e().name]||[]))}),ae(()=>v(e()),()=>{J(d,f(e().name))}),Fe(),ke();var k=Ot(),F=w(k);let M;var O=w(F),T=w(O),g=G(T);{var P=y=>{var R=yt();let H;var ve=w(R);{var pe=D=>{var B=$e("⚠️");N(D,B)},me=D=>{var B=$e("ℹ️");N(D,B)};ne(ve,D=>{v(e()),h(()=>S(e().name)==="user-changeable")?D(pe):D(me,!1)})}C(R),ee((D,B)=>{H=he(R,1,"conflict-badge svelte-1q8hvhi",null,H,D),ut(R,"title",B)},[()=>({"user-changeable":S(e().name)==="user-changeable",automatic:S(e().name)==="automatic"}),()=>(v(e()),h(()=>S(e().name)==="user-changeable"?"You can change this selection to resolve conflicts":"This feature conflicts with your other selections"))]),N(y,R)};ne(g,y=>{r(d)&&y(P)})}C(O);var b=G(O,2),q=w(b,!0);C(b),C(F);var I=G(F,2);{var j=y=>{var R=kt(),H=X(R),ve=w(H);mt(ve,()=>(v(e()),h(()=>e().description))),C(H);var pe=G(H,2);{var me=D=>{var B=St(),we=X(B);ie(we,1,()=>(v(e()),h(()=>Array(e().featureOptions.numPicks))),qe,(se,Ae,U)=>{var le=ce(),He=X(le);Re(He,()=>(v(e()),v(z()),h(()=>`${e().name}:${U}:${z()}`)),Ge=>{var Z=Ct(),re=w(Z),Me=w(re,!0);C(re),re.value=re.__value="";var Ue=G(re);ie(Ue,1,()=>h(()=>A(U)),K=>typeof K=="string"?K:K.name,(K,L)=>{var oe=bt(),Ye=w(oe,!0);C(oe);var Pe={};ee(()=>{te(Ye,(r(L),h(()=>typeof r(L)=="string"?r(L):r(L).name))),Pe!==(Pe=(r(L),h(()=>typeof r(L)=="string"?r(L):r(L).name)))&&(oe.value=(oe.__value=(r(L),h(()=>typeof r(L)=="string"?r(L):r(L).name)))??"")}),N(K,oe)}),C(Z);var Te;dt(Z),ee(()=>{te(Me,(v(e()),h(()=>e().featureOptions.placeholderText||"Select an option"))),Te!==(Te=(v(i()),v(e()),h(()=>i()[e().name]?.[U]||"")))&&(Z.value=(Z.__value=(v(i()),v(e()),h(()=>i()[e().name]?.[U]||"")))??"",vt(Z,(v(i()),v(e()),h(()=>i()[e().name]?.[U]||""))))}),be("change",Z,K=>$(K,U)),N(Ge,Z)}),N(se,le)});var We=G(we,2);ie(We,1,()=>r(u),se=>se.name,(se,Ae)=>{var U=ce(),le=X(U);Le(le,{get feature(){return r(Ae)},get featureSelections(){return i()},get expandedFeatures(){return V()},get selectionVersion(){return z()},get characterStore(){return _()},get onSelectOption(){return W()},get onToggleExpand(){return a()},nested:!0}),N(se,U)}),N(D,B)};ne(pe,D=>{v(e()),h(()=>e().featureOptions)&&D(me)})}N(y,R)};ne(I,y=>{r(o)&&y(j)})}C(k),ee(y=>{he(k,1,`feature-card ${r(t)?"incomplete":r(s)?"complete":""} ${E()?"nested":""}`,"svelte-1q8hvhi"),M=he(F,1,"feature-header svelte-1q8hvhi",null,M,y),te(T,`${v(e()),h(()=>e().name)??""} `),te(q,r(o)?"–":"+")},[()=>({"has-conflicts":r(d)})]),be("click",F,()=>a()(e().name)),N(c,k),Se(),l()}function Ht(c,n){Ce(n,!1);const[p,l]=Oe(),m=()=>Ne(Ee,"$conflicts",p);let o=x(n,"features",8),t=x(n,"featureSelections",12),s=x(n,"expandedFeatures",12),u=x(n,"selectionVersion",8),d=x(n,"characterStore",8),e=x(n,"onBumpVersion",8);function i(a,f,S){if(!S)return;const A=S,$=a.featureOptions?.numPicks||1;t()[a.name]?z(t()[a.name],$):t(t()[a.name]=Array($).fill(null),!0);const k=t()[a.name][f],F=[...t()[a.name]];if(F[f]=A,t({...t(),[a.name]:F}),e()(),k===A)return;t(ht(a,t()));const M=`feature:${a.name}:${f}`;if(_(a,A,M,f),k){const O=de(a,[k])||[];for(const T of O){if(T.featureOptions)continue;const g=`feature:${a.name}:${f}:${T.name}`;ge(g,{})}}setTimeout(()=>{Ie(Ee)},0)}function V(a){s().has(a)?s().delete(a):s().add(a),s(new Set(s()))}function z(a,f){if(a.length<f){const S=a.length;a.length=f;for(let A=S;A<f;A++)a[A]=null}}function _(a,f,S,A){const $={},k={},F=a.effects||[];for(const O of F){if(!_t(O))continue;const T=(b,q=!1)=>{if(typeof b!="string")return b;let I=b.replace(/\{userChoice\}/g,f);return q&&(I=I.toLowerCase().replace(/\s+/g,"_")),I},g=T(O.target,!0),P=T(O.value);switch(O.action){case"add":{const b=Array.isArray(P)?P:[P];$[g]||($[g]=[]),$[g].push(...b);break}case"set":{$[g]=P;break}case"modify":{const b=Number(P);isNaN(b)||(k[g]=(k[g]??0)+b);break}}}ge(S,$,k);const M=de(a,[f])||[];for(const O of M){if(O.featureOptions)continue;const T=`feature:${a.name}:${A}:${O.name}`,g={},P={};for(const b of O.effects||[]){const q=b.target,I=b.value;switch(b.action){case"add":{const j=Array.isArray(I)?I:[I];g[q]||(g[q]=[]),g[q].push(...j);break}case"set":{g[q]=I;break}case"modify":{const j=Number(I);isNaN(j)||(P[q]=(P[q]??0)+j);break}}}ge(T,g,P)}}ke();var E=ce(),W=X(E);ie(W,1,o,a=>a.name,(a,f)=>{var S=ce(),A=X(S);Re(A,()=>(r(f),v(u()),m(),h(()=>`${r(f).name}:${u()}:${m().hasConflicts}`)),$=>{Le($,{get feature(){return r(f)},get featureSelections(){return t()},get expandedFeatures(){return s()},get selectionVersion(){return u()},get characterStore(){return d()},onSelectOption:i,onToggleExpand:V})}),N(a,S)}),N(c,E),Se(),l()}var Nt=Y('<div class="conflict-item svelte-1unacg1"><div class="conflict-description svelte-1unacg1"> </div> <div class="conflict-resolution svelte-1unacg1"><strong>Resolution:</strong> </div></div>'),wt=Y('<div class="conflicts-list svelte-1unacg1"></div> <div class="guidance-section svelte-1unacg1"><p class="svelte-1unacg1">Go to the highlighted tabs and make different selections to avoid duplicates.</p></div>',1),At=Y('<div class="conflict-warning-container svelte-1unacg1"><div class="conflict-warning svelte-1unacg1"><button class="warning-header svelte-1unacg1"><div class="header-content svelte-1unacg1"><span class="warning-icon svelte-1unacg1">⚠️</span> <h3 class="svelte-1unacg1">Conflicts Detected</h3></div> <span class="expand-indicator svelte-1unacg1"> </span></button> <!></div></div>');function Gt(c,n){Ce(n,!1);const[p,l]=Oe(),m=()=>Ne(Ve,"$activeConflicts",p),o=Q();let t=x(n,"tabName",8,""),s=Q(!1);function u(){J(s,!r(s))}function d(_){const W={skill:"Skill",proficiency:"Proficiency",language:"Language",feature:"Feature"}[_.type]||_.type,a=_.sources.map(f=>f.startsWith("bard.")?"Bard class":f.startsWith("high_elf.")?"High Elf race":f.startsWith("hill_dwarf.")?"Hill Dwarf race":f.startsWith("fighter.")?"Fighter class":f);return`${W} "${_.value}" is granted by multiple sources: ${a.join(", ")}`}function e(_){const E=pt(_);return E?`Go to the ${E.charAt(0).toUpperCase()+E.slice(1)} tab and select a different ${_.type} to resolve this conflict.`:"This conflict involves automatic grants. Consider changing your other selections."}ae(()=>(m(),v(t())),()=>{J(o,m().conflicts.filter(_=>_.affectedTabs?.includes(t())??!1))}),Fe(),ke();var i=ce(),V=X(i);{var z=_=>{var E=At(),W=w(E),a=w(W),f=G(w(a),2),S=w(f,!0);C(f),C(a);var A=G(a,2);{var $=k=>{var F=wt(),M=X(F);ie(M,5,()=>r(o),qe,(O,T)=>{var g=Nt(),P=w(g),b=w(P,!0);C(P);var q=G(P,2),I=G(w(q));C(q),C(g),ee((j,y)=>{te(b,j),te(I,` ${y??""}`)},[()=>(r(T),h(()=>d(r(T)))),()=>(r(T),h(()=>e(r(T))))]),N(O,g)}),C(M),ft(2),N(k,F)};ne(A,k=>{r(s)&&k($)})}C(W),C(E),ee(()=>te(S,r(s)?"−":"+")),be("click",a,u),N(_,E)};ne(V,_=>{r(o),h(()=>r(o).length>0)&&_(z)})}N(c,i),Se(),l()}export{Gt as C,Ht as F,mt as h,De as i};
