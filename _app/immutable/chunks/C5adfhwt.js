import"./DsnmJJEf.js";import"./CQMj6I71.js";import{h as be,Y as qe,aU as ze,aV as De,aW as He,X as Re,a9 as Ye,a0 as Ge,ax as Ke,au as We,a3 as Xe,aK as Ze,aC as $e,y as Ce,ah as M,j as Q,aj as ee,a8 as i,d as s,ai as Je,z as W,E as B,C as G,F as q,al as re,v as _,A as F,B as Ae,ao as K,aO as Se,an as le}from"./D8epjS11.js";import{e as ie,i as Me}from"./Cf40ah7q.js";import{i as xe}from"./nRLFwT7N.js";import{p as O}from"./D50GnoSP.js";import{i as oe,s as Ne,a as Pe}from"./DNOeg3kL.js";import{g as Fe,s as ce,e as Oe}from"./BiH1rH3r.js";import{a as pe}from"./CFTOOR2V.js";import{a as Qe,c as ke}from"./geuvUz3z.js";import{h as et}from"./B9K-xhhX.js";import{s as tt}from"./Dmswp-gS.js";import{s as ve}from"./BUqHBage.js";import{i as nt,s as at}from"./CJrJrPvA.js";function Te(r,t,m){be&&qe();var l=r,p=Ze,c,n,o=null,y=ze()?De:He;function f(){c&&$e(c),o!==null&&(o.lastChild.remove(),l.before(o),o=null),c=n}Re(()=>{if(y(p,p=t())){var e=l,u=We();u&&(o=document.createDocumentFragment(),o.append(e=Ye())),n=Ge(()=>m(e)),u?Ke.add_callback(f):f()}}),be&&(l=Xe)}function Ve(r,t){if(!r.featureOptions)return!1;const m=t[r.name]||[],l=r.featureOptions.numPicks||1;if(m.filter(n=>n!==null&&n!=="").length<l)return!0;const c=fe(r,m);if(c.length>0){for(const n of c)if(Ve(n,t))return!0}return!1}function fe(r,t){if(!r.featureOptions)return[];const m=[];for(const l of r.featureOptions.options){const p=typeof l=="string"?l:l.name;t.includes(p)&&typeof l!="string"&&l.nestedPrompts&&m.push(...l.nestedPrompts)}return m}function st(r,t,m,l){const p=r.featureOptions?.options||[],c=m[r.name]||[],n=c[t]??null,o=Fe(l),y=new Set;if(Array.isArray(o.skills))for(const f of o.skills)y.add(f);if(Array.isArray(o.languages))for(const f of o.languages)y.add(f);if(Array.isArray(o.proficiencies))for(const f of o.proficiencies)y.add(f);for(const[f,e]of Object.entries(m))for(const[u,E]of(e||[]).entries())E&&(f===r.name&&u===t||y.add(E));return p.filter(f=>{const e=typeof f=="string"?f:f.name;return c.some((u,E)=>u===e&&E!==t)?!1:n===e?!0:!y.has(e)})}function rt(r,t){if(!r.featureOptions)return t;const m={...t};let l=!1;function p(c){if(m[c.name]&&(delete m[c.name],l=!0),c.featureOptions){for(const n of c.featureOptions.options)if(typeof n!="string"&&n.nestedPrompts)for(const o of n.nestedPrompts)p(o)}}for(const c of r.featureOptions.options)if(typeof c!="string"&&c.nestedPrompts)for(const n of c.nestedPrompts)p(n);return l?m:t}function ot(r){return typeof r.target=="string"&&r.target.includes("{userChoice}")||typeof r.value=="string"&&r.value.includes("{userChoice}")}var ct=W("<span><!></span>"),it=W('<option class="svelte-1cl69m0"> </option>'),lt=W('<select class="svelte-1cl69m0"><option disabled class="svelte-1cl69m0"> </option><!></select>'),ft=W("<!> <!>",1),ut=W('<p class="svelte-1cl69m0"><!></p> <!>',1),mt=W('<div><button type="button"><span class="feature-name svelte-1cl69m0"> <!></span> <span class="expand-indicator svelte-1cl69m0"> </span></button> <!></div>');function Ee(r,t){Ce(t,!1);const[m,l]=Ne(),p=()=>Pe(Qe,"$activeConflicts",m),c=ee(),n=ee(),o=ee(),y=ee(),f=ee();let e=O(t,"feature",8),u=O(t,"featureSelections",8),E=O(t,"expandedFeatures",8),X=O(t,"selectionVersion",8),te=O(t,"characterStore",8),ne=O(t,"nested",8,!1),ae=O(t,"onSelectOption",8),a=O(t,"onToggleExpand",8);function d(g){return p().hasConflicts?p().conflicts.some(x=>x.sources.some(U=>U.includes(g))):!1}function b(g){return s(f)?e().featureOptions?"user-changeable":"automatic":"none"}function k(g){return st(e(),g,u(),te())}function C(g,x){const U=g.target;ae()(e(),x,U.value)}M(()=>(i(E()),i(e())),()=>{Q(c,E().has(e().name))}),M(()=>(i(e()),i(u())),()=>{Q(n,Ve(e(),u()))}),M(()=>(s(n),i(e())),()=>{Q(o,!s(n)&&e().featureOptions)}),M(()=>(i(e()),i(u())),()=>{Q(y,fe(e(),u()[e().name]||[]))}),M(()=>i(e()),()=>{Q(f,d(e().name))}),Je(),xe();var A=mt(),I=B(A);let R;var S=B(I),w=B(S),v=G(w);{var T=g=>{var x=ct();let U;var ue=B(x);{var me=N=>{var z=Se("⚠️");F(N,z)},de=N=>{var z=Se("🔒");F(N,z)};oe(ue,N=>{i(e()),_(()=>b(e().name)==="user-changeable")?N(me):N(de,!1)})}q(x),re((N,z)=>{U=ve(x,1,"conflict-badge svelte-1cl69m0",null,U,N),tt(x,"title",z)},[()=>({"user-changeable":b(e().name)==="user-changeable",automatic:b(e().name)==="automatic"}),()=>(i(e()),_(()=>b(e().name)==="user-changeable"?"You can change this selection to resolve conflicts":"This feature conflicts with your other selections, but has no alternative options"))]),F(g,x)};oe(v,g=>{s(f)&&g(T)})}q(S);var h=G(S,2),L=B(h,!0);q(h),q(I);var V=G(I,2);{var Y=g=>{var x=ut(),U=K(x),ue=B(U);et(ue,()=>(i(e()),_(()=>e().description))),q(U);var me=G(U,2);{var de=N=>{var z=ft(),ge=K(z);ie(ge,1,()=>(i(e()),_(()=>Array(e().featureOptions.numPicks))),Me,(Z,_e,j)=>{var se=le(),we=K(se);Te(we,()=>(i(e()),i(X()),_(()=>`${e().name}:${j}:${X()}`)),Le=>{var D=lt(),$=B(D),Ue=B($,!0);q($),$.value=$.__value="";var je=G($);ie(je,1,()=>_(()=>k(j)),H=>typeof H=="string"?H:H.name,(H,P)=>{var J=it(),Be=B(J,!0);q(J);var ye={};re(()=>{ce(Be,(s(P),_(()=>typeof s(P)=="string"?s(P):s(P).name))),ye!==(ye=(s(P),_(()=>typeof s(P)=="string"?s(P):s(P).name)))&&(J.value=(J.__value=(s(P),_(()=>typeof s(P)=="string"?s(P):s(P).name)))??"")}),F(H,J)}),q(D);var he;nt(D),re(()=>{ce(Ue,(i(e()),_(()=>e().featureOptions.placeholderText||"Select an option"))),he!==(he=(i(u()),i(e()),_(()=>u()[e().name]?.[j]||"")))&&(D.value=(D.__value=(i(u()),i(e()),_(()=>u()[e().name]?.[j]||"")))??"",at(D,(i(u()),i(e()),_(()=>u()[e().name]?.[j]||""))))}),Oe("change",D,H=>C(H,j)),F(Le,D)}),F(Z,se)});var Ie=G(ge,2);ie(Ie,1,()=>s(y),Z=>Z.name,(Z,_e)=>{var j=le(),se=K(j);Ee(se,{get feature(){return s(_e)},get featureSelections(){return u()},get expandedFeatures(){return E()},get selectionVersion(){return X()},get characterStore(){return te()},get onSelectOption(){return ae()},get onToggleExpand(){return a()},nested:!0}),F(Z,j)}),F(N,z)};oe(me,N=>{i(e()),_(()=>e().featureOptions)&&N(de)})}F(g,x)};oe(V,g=>{s(c)&&g(Y)})}q(A),re(g=>{ve(A,1,`feature-card ${s(n)?"incomplete":s(o)?"complete":""} ${ne()?"nested":""}`,"svelte-1cl69m0"),R=ve(I,1,"feature-header svelte-1cl69m0",null,R,g),ce(w,`${i(e()),_(()=>e().name)??""} `),ce(L,s(c)?"–":"+")},[()=>({"has-conflicts":s(f)})]),Oe("click",I,()=>a()(e().name)),F(r,A),Ae(),l()}function Nt(r,t){Ce(t,!1);const[m,l]=Ne(),p=()=>Pe(ke,"$conflicts",m);let c=O(t,"features",8),n=O(t,"featureSelections",12),o=O(t,"expandedFeatures",12),y=O(t,"selectionVersion",8),f=O(t,"characterStore",8),e=O(t,"onBumpVersion",8);function u(a,d,b){if(!b)return;const k=b,C=a.featureOptions?.numPicks||1;n()[a.name]?X(n()[a.name],C):n(n()[a.name]=Array(C).fill(null),!0);const A=n()[a.name][d],I=[...n()[a.name]];if(I[d]=k,n({...n(),[a.name]:I}),e()(),A===k)return;n(rt(a,n()));const R=`feature:${a.name}:${d}`;if(te(a,k,R,d),A){const S=fe(a,[A])||[];for(const w of S){if(w.featureOptions)continue;const v=`feature:${a.name}:${d}:${w.name}`;pe(v,{})}}setTimeout(()=>{Fe(ke)},0)}function E(a){o().has(a)?o().delete(a):o().add(a),o(new Set(o()))}function X(a,d){if(a.length<d){const b=a.length;a.length=d;for(let k=b;k<d;k++)a[k]=null}}function te(a,d,b,k){const C={},A={},I=a.effects||[];for(const S of I){if(!ot(S))continue;const w=(h,L=!1)=>{if(typeof h!="string")return h;let V=h.replace(/\{userChoice\}/g,d);return L&&(V=V.toLowerCase().replace(/\s+/g,"_")),V},v=w(S.target,!0),T=w(S.value);switch(S.action){case"add":{const h=Array.isArray(T)?T:[T];C[v]||(C[v]=[]),C[v].push(...h);break}case"set":{C[v]=T;break}case"modify":{const h=Number(T);isNaN(h)||(A[v]=(A[v]??0)+h);break}}}pe(b,C,A);const R=fe(a,[d])||[];for(const S of R){if(S.featureOptions)continue;const w=`feature:${a.name}:${k}:${S.name}`,v={},T={};for(const h of S.effects||[]){const L=h.target,V=h.value;switch(h.action){case"add":{const Y=Array.isArray(V)?V:[V];v[L]||(v[L]=[]),v[L].push(...Y);break}case"set":{v[L]=V;break}case"modify":{const Y=Number(V);isNaN(Y)||(T[L]=(T[L]??0)+Y);break}}}pe(w,v,T)}}xe();var ne=le(),ae=K(ne);ie(ae,1,c,a=>a.name,(a,d)=>{var b=le(),k=K(b);Te(k,()=>(s(d),i(y()),p(),_(()=>`${s(d).name}:${y()}:${p().hasConflicts}`)),C=>{Ee(C,{get feature(){return s(d)},get featureSelections(){return n()},get expandedFeatures(){return o()},get selectionVersion(){return y()},get characterStore(){return f()},onSelectOption:u,onToggleExpand:E})}),F(a,b)}),F(r,ne),Ae(),l()}export{Nt as F,ot as e,Ve as i};
