import"./DsnmJJEf.js";import"./69_IOA4Y.js";import{q as ue,X as _e,aY as Ye,aZ as Ze,aV as je,W as ze,a8 as Ke,$ as Xe,an as Je,ak as Qe,a2 as ye,aB as et,at as tt,aE as ee,c as at,a_ as nt,aa as st,ac as rt,aS as ot,aR as it,Z as Ee,ae as ct,Y as lt,a3 as fe,x as Ce,aG as ae,s as J,ap as Q,a7 as v,a as r,aH as Fe,y as U,C as A,B,E as C,u as h,z as N,A as Se,aD as z,aL as Pe,aK as ce,aF as ft}from"./DP8K6xNq.js";import{e as ie,i as qe}from"./C_WCNbho.js";import{i as ke}from"./CzQ8VDlG.js";import{p as E}from"./Dy7MktMn.js";import{i as ne,s as Oe,a as Ne}from"./D1udGSV0.js";import{g as Ie,a as te,e as be}from"./sKoe4dLO.js";import{a as ge}from"./r6ohDICE.js";import{s as he,a as Re,c as $e}from"./eOUMTw-v.js";import{s as ut}from"./Cdqfyt8S.js";import{i as dt,s as vt}from"./CsPdG-MN.js";import{g as pt}from"./BmHR2rV7.js";function Ve(c,n,p){ue&&_e();var l=c,m=et,o,t,s=null,u=Ye()?Ze:je;function d(){o&&tt(o),s!==null&&(s.lastChild.remove(),l.before(s),s=null),o=t}ze(()=>{if(u(m,m=n())){var e=l,i=Qe();i&&(s=document.createDocumentFragment(),s.append(e=Ke())),t=Xe(()=>p(e)),i?Je.add_callback(d):d()}}),ue&&(l=ye)}function mt(c,n,p=!1,l=!1,m=!1){var o=c,t="";ee(()=>{var s=at;if(t===(t=n()??"")){ue&&_e();return}if(s.nodes_start!==null&&(nt(s.nodes_start,s.nodes_end),s.nodes_start=s.nodes_end=null),t!==""){if(ue){ye.data;for(var u=_e(),d=u;u!==null&&(u.nodeType!==st||u.data!=="");)d=u,u=rt(u);if(u===null)throw ot(),it;Ee(ye,d),o=ct(u);return}var e=t+"";p?e=`<svg>${e}</svg>`:l&&(e=`<math>${e}</math>`);var i=lt(e);if((p||l)&&(i=fe(i)),Ee(fe(i),i.lastChild),p||l)for(;fe(i);)o.before(fe(i));else o.before(i)}})}function De(c,n){if(!c.featureOptions)return!1;const p=n[c.name]||[],l=c.featureOptions.numPicks||1;if(p.filter(t=>t!==null&&t!=="").length<l)return!0;const o=de(c,p);if(o.length>0){for(const t of o)if(De(t,n))return!0}return!1}function de(c,n){if(!c.featureOptions)return[];const p=[];for(const l of c.featureOptions.options){const m=typeof l=="string"?l:l.name;n.includes(m)&&typeof l!="string"&&l.nestedPrompts&&p.push(...l.nestedPrompts)}return p}function gt(c,n,p,l){const m=c.featureOptions?.options||[],o=p[c.name]||[],t=o[n]??null,s=Ie(l),u=new Set;if(Array.isArray(s.skills))for(const d of s.skills)u.add(d);if(Array.isArray(s.languages))for(const d of s.languages)u.add(d);if(Array.isArray(s.proficiencies))for(const d of s.proficiencies)u.add(d);for(const[d,e]of Object.entries(p))for(const[i,R]of(e||[]).entries())R&&(d===c.name&&i===n||u.add(R));return m.filter(d=>{const e=typeof d=="string"?d:d.name;return o.some((i,R)=>i===e&&R!==n)?!1:t===e?!0:!u.has(e)})}function ht(c,n){if(!c.featureOptions)return n;const p={...n};let l=!1;function m(o){if(p[o.name]&&(delete p[o.name],l=!0),o.featureOptions){for(const t of o.featureOptions.options)if(typeof t!="string"&&t.nestedPrompts)for(const s of t.nestedPrompts)m(s)}}for(const o of c.featureOptions.options)if(typeof o!="string"&&o.nestedPrompts)for(const t of o.nestedPrompts)m(t);return l?p:n}function _t(c){return typeof c.target=="string"&&c.target.includes("{userChoice}")||typeof c.value=="string"&&c.value.includes("{userChoice}")}var yt=U("<span><!></span>"),bt=U('<option class="svelte-1q8hvhi"> </option>'),Ct=U('<select class="svelte-1q8hvhi"><option disabled class="svelte-1q8hvhi"> </option><!></select>'),St=U("<!> <!>",1),kt=U('<p class="svelte-1q8hvhi"><!></p> <!>',1),Ot=U('<div><button type="button"><span class="feature-name svelte-1q8hvhi"> <!></span> <span class="expand-indicator svelte-1q8hvhi"> </span></button> <!></div>');function Le(c,n){Ce(n,!1);const[p,l]=Oe(),m=()=>Ne(Re,"$activeConflicts",p),o=Q(),t=Q(),s=Q(),u=Q(),d=Q();let e=E(n,"feature",8),i=E(n,"featureSelections",8),R=E(n,"expandedFeatures",8),K=E(n,"selectionVersion",8),_=E(n,"characterStore",8),$=E(n,"nested",8,!1),H=E(n,"onSelectOption",8),a=E(n,"onToggleExpand",8);function f(y){return m().hasConflicts?m().conflicts.some(V=>V.sources.some(W=>W.includes(y))):!1}function S(y){return r(d)?e().featureOptions?"user-changeable":"automatic":"none"}function w(y){return gt(e(),y,i(),_())}function P(y,V){const W=y.target;H()(e(),V,W.value)}ae(()=>(v(R()),v(e())),()=>{J(o,R().has(e().name))}),ae(()=>(v(e()),v(i())),()=>{J(t,De(e(),i()))}),ae(()=>(r(t),v(e())),()=>{J(s,!r(t)&&e().featureOptions)}),ae(()=>(v(e()),v(i())),()=>{J(u,de(e(),i()[e().name]||[]))}),ae(()=>v(e()),()=>{J(d,f(e().name))}),Fe(),ke();var k=Ot(),F=A(k);let G;var O=A(F),T=A(O),g=B(T);{var x=y=>{var V=yt();let W;var ve=A(V);{var pe=D=>{var Z=Pe("⚠️");N(D,Z)},me=D=>{var Z=Pe("ℹ️");N(D,Z)};ne(ve,D=>{v(e()),h(()=>S(e().name)==="user-changeable")?D(pe):D(me,!1)})}C(V),ee((D,Z)=>{W=he(V,1,"conflict-badge svelte-1q8hvhi",null,W,D),ut(V,"title",Z)},[()=>({"user-changeable":S(e().name)==="user-changeable",automatic:S(e().name)==="automatic"}),()=>(v(e()),h(()=>S(e().name)==="user-changeable"?"You can change this selection to resolve conflicts":"This feature conflicts with your other selections"))]),N(y,V)};ne(g,y=>{r(d)&&y(x)})}C(O);var b=B(O,2),q=A(b,!0);C(b),C(F);var I=B(F,2);{var Y=y=>{var V=kt(),W=z(V),ve=A(W);mt(ve,()=>(v(e()),h(()=>e().description))),C(W);var pe=B(W,2);{var me=D=>{var Z=St(),Ae=z(Z);ie(Ae,1,()=>(v(e()),h(()=>Array(e().featureOptions.numPicks))),qe,(se,we,M)=>{var le=ce(),We=z(le);Ve(We,()=>(v(e()),v(K()),h(()=>`${e().name}:${M}:${K()}`)),Be=>{var j=Ct(),re=A(j),Ge=A(re,!0);C(re),re.value=re.__value="";var Me=B(re);ie(Me,1,()=>h(()=>w(M)),X=>typeof X=="string"?X:X.name,(X,L)=>{var oe=bt(),Ue=A(oe,!0);C(oe);var xe={};ee(()=>{te(Ue,(r(L),h(()=>typeof r(L)=="string"?r(L):r(L).name))),xe!==(xe=(r(L),h(()=>typeof r(L)=="string"?r(L):r(L).name)))&&(oe.value=(oe.__value=(r(L),h(()=>typeof r(L)=="string"?r(L):r(L).name)))??"")}),N(X,oe)}),C(j);var Te;dt(j),ee(()=>{te(Ge,(v(e()),h(()=>e().featureOptions.placeholderText||"Select an option"))),Te!==(Te=(v(i()),v(e()),h(()=>i()[e().name]?.[M]||"")))&&(j.value=(j.__value=(v(i()),v(e()),h(()=>i()[e().name]?.[M]||"")))??"",vt(j,(v(i()),v(e()),h(()=>i()[e().name]?.[M]||""))))}),be("change",j,X=>P(X,M)),N(Be,j)}),N(se,le)});var He=B(Ae,2);ie(He,1,()=>r(u),se=>se.name,(se,we)=>{var M=ce(),le=z(M);Le(le,{get feature(){return r(we)},get featureSelections(){return i()},get expandedFeatures(){return R()},get selectionVersion(){return K()},get characterStore(){return _()},get onSelectOption(){return H()},get onToggleExpand(){return a()},nested:!0}),N(se,M)}),N(D,Z)};ne(pe,D=>{v(e()),h(()=>e().featureOptions)&&D(me)})}N(y,V)};ne(I,y=>{r(o)&&y(Y)})}C(k),ee(y=>{he(k,1,`feature-card ${r(t)?"incomplete":r(s)?"complete":""} ${$()?"nested":""}`,"svelte-1q8hvhi"),G=he(F,1,"feature-header svelte-1q8hvhi",null,G,y),te(T,`${v(e()),h(()=>e().name)??""} `),te(q,r(o)?"–":"+")},[()=>({"has-conflicts":r(d)})]),be("click",F,()=>a()(e().name)),N(c,k),Se(),l()}function Wt(c,n){Ce(n,!1);const[p,l]=Oe(),m=()=>Ne($e,"$conflicts",p);let o=E(n,"features",8),t=E(n,"featureSelections",12),s=E(n,"expandedFeatures",12),u=E(n,"selectionVersion",8),d=E(n,"characterStore",8),e=E(n,"onBumpVersion",8);function i(a,f,S){if(!S)return;const w=S,P=a.featureOptions?.numPicks||1;t()[a.name]?K(t()[a.name],P):t(t()[a.name]=Array(P).fill(null),!0);const k=t()[a.name][f],F=[...t()[a.name]];if(F[f]=w,t({...t(),[a.name]:F}),e()(),k===w)return;t(ht(a,t()));const G=`feature:${a.name}:${f}`;if(_(a,w,G,f),k){const O=de(a,[k])||[];for(const T of O){if(T.featureOptions)continue;const g=`feature:${a.name}:${f}:${T.name}`;ge(g,{})}}setTimeout(()=>{Ie($e)},0)}function R(a){s().has(a)?s().delete(a):s().add(a),s(new Set(s()))}function K(a,f){if(a.length<f){const S=a.length;a.length=f;for(let w=S;w<f;w++)a[w]=null}}function _(a,f,S,w){const P={},k={},F=a.effects||[];for(const O of F){if(!_t(O))continue;const T=(b,q=!1)=>{if(typeof b!="string")return b;let I=b.replace(/\{userChoice\}/g,f);return q&&(I=I.toLowerCase().replace(/\s+/g,"_")),I},g=T(O.target,!0),x=T(O.value);switch(O.action){case"add":{const b=Array.isArray(x)?x:[x];P[g]||(P[g]=[]),P[g].push(...b);break}case"set":{P[g]=x;break}case"modify":{const b=Number(x);isNaN(b)||(k[g]=(k[g]??0)+b);break}}}ge(S,P,k);const G=de(a,[f])||[];for(const O of G){if(O.featureOptions)continue;const T=`feature:${a.name}:${w}:${O.name}`,g={},x={};for(const b of O.effects||[]){const q=b.target,I=b.value;switch(b.action){case"add":{const Y=Array.isArray(I)?I:[I];g[q]||(g[q]=[]),g[q].push(...Y);break}case"set":{g[q]=I;break}case"modify":{const Y=Number(I);isNaN(Y)||(x[q]=(x[q]??0)+Y);break}}}ge(T,g,x)}}ke();var $=ce(),H=z($);ie(H,1,o,a=>a.name,(a,f)=>{var S=ce(),w=z(S);Ve(w,()=>(r(f),v(u()),m(),h(()=>`${r(f).name}:${u()}:${m().hasConflicts}`)),P=>{Le(P,{get feature(){return r(f)},get featureSelections(){return t()},get expandedFeatures(){return s()},get selectionVersion(){return u()},get characterStore(){return d()},onSelectOption:i,onToggleExpand:R})}),N(a,S)}),N(c,$),Se(),l()}var Nt=U('<div class="conflict-item svelte-1unacg1"><div class="conflict-description svelte-1unacg1"> </div> <div class="conflict-resolution svelte-1unacg1"><strong>Resolution:</strong> </div></div>'),At=U('<div class="conflicts-list svelte-1unacg1"></div> <div class="guidance-section svelte-1unacg1"><p class="svelte-1unacg1">Go to the highlighted tabs and make different selections to avoid duplicates.</p></div>',1),wt=U('<div class="conflict-warning-container svelte-1unacg1"><div class="conflict-warning svelte-1unacg1"><button class="warning-header svelte-1unacg1"><div class="header-content svelte-1unacg1"><span class="warning-icon svelte-1unacg1">⚠️</span> <h3 class="svelte-1unacg1">Conflicts Detected</h3></div> <span class="expand-indicator svelte-1unacg1"> </span></button> <!></div></div>');function Bt(c,n){Ce(n,!1);const[p,l]=Oe(),m=()=>Ne(Re,"$activeConflicts",p),o=Q();let t=E(n,"tabName",8,""),s=Q(!1);function u(){J(s,!r(s))}function d(_){const H={skill:"Skill",proficiency:"Proficiency",language:"Language",feature:"Feature"}[_.type]||_.type,a=_.sources.map(f=>f.startsWith("bard.")?"Bard class":f.startsWith("high_elf.")?"High Elf race":f.startsWith("hill_dwarf.")?"Hill Dwarf race":f.startsWith("fighter.")?"Fighter class":f);return`${H} "${_.value}" is granted by multiple sources: ${a.join(", ")}`}function e(_){const $=pt(_);return $?`Go to the ${$.charAt(0).toUpperCase()+$.slice(1)} tab and select a different ${_.type} to resolve this conflict.`:"This conflict involves automatic grants. Consider changing your other selections."}ae(()=>(m(),v(t())),()=>{J(o,m().conflicts.filter(_=>_.affectedTabs?.includes(t())??!1))}),Fe(),ke();var i=ce(),R=z(i);{var K=_=>{var $=wt(),H=A($),a=A(H),f=B(A(a),2),S=A(f,!0);C(f),C(a);var w=B(a,2);{var P=k=>{var F=At(),G=z(F);ie(G,5,()=>r(o),qe,(O,T)=>{var g=Nt(),x=A(g),b=A(x,!0);C(x);var q=B(x,2),I=B(A(q));C(q),C(g),ee((Y,y)=>{te(b,Y),te(I,` ${y??""}`)},[()=>(r(T),h(()=>d(r(T)))),()=>(r(T),h(()=>e(r(T))))]),N(O,g)}),C(G),ft(2),N(k,F)};ne(w,k=>{r(s)&&k(P)})}C(H),C($),ee(()=>te(S,r(s)?"−":"+")),be("click",a,u),N(_,$)};ne(R,_=>{r(o),h(()=>r(o).length>0)&&_(K)})}N(c,i),Se(),l()}export{Bt as C,Wt as F,_t as e,mt as h,De as i};
