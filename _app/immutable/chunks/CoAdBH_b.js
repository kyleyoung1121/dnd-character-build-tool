import"./DsnmJJEf.js";import"./69_IOA4Y.js";import{h as ue,k as he,aX as qe,aY as Be,aS as Ze,d as Xe,c as ze,u as Ke,y as Je,v as Qe,p as ye,V as et,G as tt,at as ee,T as at,aZ as nt,C as st,P as rt,aP as ot,aO as it,ag as xe,f as ct,af as lt,j as fe,W as Ce,ap as ae,ar as J,A as Q,al as v,l as n,aq as Ee,X as Y,$ as w,_ as G,a0 as C,a7 as _,Y as N,Z as Se,aw as X,aW as Pe,av as ce,aK as ft}from"./BOKL8LPc.js";import{e as ie,i as je}from"./DK8oEai0.js";import{i as ke}from"./DDng5zeD.js";import{p as x,s as Oe,a as Ne}from"./BxB93vFd.js";import{g as Ie,s as te,e as be}from"./BGP3eZCr.js";import{a as ge}from"./CERfiCyH.js";import{s as _e,a as Ve,c as $e}from"./2jXKZ2eE.js";import{i as ne}from"./BgoevHwW.js";import{s as ut}from"./Dx3zq8i6.js";import{i as dt,s as vt}from"./By06J7I7.js";import{g as pt}from"./DkRzRk7s.js";function De(i,a,p){ue&&he();var c=i,m=et,l,s,r=null,u=qe()?Be:Ze;function d(){l&&tt(l),r!==null&&(r.lastChild.remove(),c.before(r),r=null),l=s}Xe(()=>{if(u(m,m=a())){var e=c,o=Qe();o&&(r=document.createDocumentFragment(),r.append(e=ze())),s=Ke(()=>p(e)),o?Je.add_callback(d):d()}}),ue&&(c=ye)}function mt(i,a,p=!1,c=!1,m=!1){var l=i,s="";ee(()=>{var r=at;if(s===(s=a()??"")){ue&&he();return}if(r.nodes_start!==null&&(nt(r.nodes_start,r.nodes_end),r.nodes_start=r.nodes_end=null),s!==""){if(ue){ye.data;for(var u=he(),d=u;u!==null&&(u.nodeType!==st||u.data!=="");)d=u,u=rt(u);if(u===null)throw ot(),it;xe(ye,d),l=ct(u);return}var e=s+"";p?e=`<svg>${e}</svg>`:c&&(e=`<math>${e}</math>`);var o=lt(e);if((p||c)&&(o=fe(o)),xe(fe(o),o.lastChild),p||c)for(;fe(o);)l.before(fe(o));else l.before(o)}})}function Re(i,a){if(!i.featureOptions)return!1;const p=a[i.name]||[],c=i.featureOptions.numPicks||1;if(p.filter(s=>s!==null&&s!=="").length<c)return!0;const l=de(i,p);if(l.length>0){for(const s of l)if(Re(s,a))return!0}return!1}function de(i,a){if(!i.featureOptions)return[];const p=[];for(const c of i.featureOptions.options){const m=typeof c=="string"?c:c.name;a.includes(m)&&typeof c!="string"&&c.nestedPrompts&&p.push(...c.nestedPrompts)}return p}function gt(i,a,p,c){const m=i.featureOptions?.options||[],l=p[i.name]||[],s=l[a]??null,r=Ie(c),u=new Set;if(Array.isArray(r.skills))for(const d of r.skills)u.add(d);if(Array.isArray(r.languages))for(const d of r.languages)u.add(d);if(Array.isArray(r.proficiencies))for(const d of r.proficiencies)u.add(d);for(const[d,e]of Object.entries(p))for(const[o,V]of(e||[]).entries())V&&(d===i.name&&o===a||u.add(V));return m.filter(d=>{const e=typeof d=="string"?d:d.name;return l.some((o,V)=>o===e&&V!==a)?!1:s===e?!0:!u.has(e)})}function _t(i,a){if(!i.featureOptions)return a;const p={...a};let c=!1;for(const m of i.featureOptions.options)if(typeof m!="string"&&m.nestedPrompts)for(const l of m.nestedPrompts)p[l.name]&&(delete p[l.name],c=!0);return c?p:a}function ht(i){return typeof i.target=="string"&&i.target.includes("{userChoice}")||typeof i.value=="string"&&i.value.includes("{userChoice}")}var yt=Y("<span><!></span>"),bt=Y('<option class="svelte-oj22ap"> </option>'),Ct=Y('<select class="svelte-oj22ap"><option disabled class="svelte-oj22ap"> </option><!></select>'),St=Y("<!> <!>",1),kt=Y('<p class="svelte-oj22ap"><!></p> <!>',1),Ot=Y('<div><button type="button"><span class="feature-name svelte-oj22ap"> <!></span> <span class="expand-indicator svelte-oj22ap"> </span></button> <!></div>');function Le(i,a){Ce(a,!1);const[p,c]=Oe(),m=()=>Ne(Ve,"$activeConflicts",p),l=Q(),s=Q(),r=Q(),u=Q(),d=Q();let e=x(a,"feature",8),o=x(a,"featureSelections",8),V=x(a,"expandedFeatures",8),z=x(a,"selectionVersion",8),h=x(a,"characterStore",8),$=x(a,"nested",8,!1),W=x(a,"onSelectOption",8),t=x(a,"onToggleExpand",8);function f(y){return m().hasConflicts?m().conflicts.some(D=>D.sources.some(H=>H.includes(y))):!1}function S(y){return n(d)?e().featureOptions?"user-changeable":"automatic":"none"}function A(y){return gt(e(),y,o(),h())}function P(y,D){const H=y.target;W()(e(),D,H.value)}ae(()=>(v(V()),v(e())),()=>{J(l,V().has(e().name))}),ae(()=>(v(e()),v(o())),()=>{J(s,Re(e(),o()))}),ae(()=>(n(s),v(e())),()=>{J(r,!n(s)&&e().featureOptions)}),ae(()=>(v(e()),v(o())),()=>{J(u,de(e(),o()[e().name]||[]))}),ae(()=>v(e()),()=>{J(d,f(e().name))}),Ee(),ke();var k=Ot(),E=w(k);let M;var O=w(E),T=w(O),g=G(T);{var F=y=>{var D=yt();let H;var ve=w(D);{var pe=R=>{var B=Pe("⚠️");N(R,B)},me=R=>{var B=Pe("ℹ️");N(R,B)};ne(ve,R=>{v(e()),_(()=>S(e().name)==="user-changeable")?R(pe):R(me,!1)})}C(D),ee((R,B)=>{H=_e(D,1,"conflict-badge svelte-oj22ap",null,H,R),ut(D,"title",B)},[()=>({"user-changeable":S(e().name)==="user-changeable",automatic:S(e().name)==="automatic"}),()=>(v(e()),_(()=>S(e().name)==="user-changeable"?"You can change this selection to resolve conflicts":"This feature conflicts with your other selections"))]),N(y,D)};ne(g,y=>{n(d)&&y(F)})}C(O);var b=G(O,2),j=w(b,!0);C(b),C(E);var I=G(E,2);{var q=y=>{var D=kt(),H=X(D),ve=w(H);mt(ve,()=>(v(e()),_(()=>e().description))),C(H);var pe=G(H,2);{var me=R=>{var B=St(),we=X(B);ie(we,1,()=>(v(e()),_(()=>Array(e().featureOptions.numPicks))),je,(se,Ae,U)=>{var le=ce(),He=X(le);De(He,()=>(v(e()),v(z()),_(()=>`${e().name}:${U}:${z()}`)),Ge=>{var Z=Ct(),re=w(Z),Me=w(re,!0);C(re),re.value=re.__value="";var Ue=G(re);ie(Ue,1,()=>_(()=>A(U)),K=>typeof K=="string"?K:K.name,(K,L)=>{var oe=bt(),Ye=w(oe,!0);C(oe);var Fe={};ee(()=>{te(Ye,(n(L),_(()=>typeof n(L)=="string"?n(L):n(L).name))),Fe!==(Fe=(n(L),_(()=>typeof n(L)=="string"?n(L):n(L).name)))&&(oe.value=(oe.__value=(n(L),_(()=>typeof n(L)=="string"?n(L):n(L).name)))??"")}),N(K,oe)}),C(Z);var Te;dt(Z),ee(()=>{te(Me,(v(e()),_(()=>e().featureOptions.placeholderText||"Select an option"))),Te!==(Te=(v(o()),v(e()),_(()=>o()[e().name]?.[U]||"")))&&(Z.value=(Z.__value=(v(o()),v(e()),_(()=>o()[e().name]?.[U]||"")))??"",vt(Z,(v(o()),v(e()),_(()=>o()[e().name]?.[U]||""))))}),be("change",Z,K=>P(K,U)),N(Ge,Z)}),N(se,le)});var We=G(we,2);ie(We,1,()=>n(u),se=>se.name,(se,Ae)=>{var U=ce(),le=X(U);Le(le,{get feature(){return n(Ae)},get featureSelections(){return o()},get expandedFeatures(){return V()},get selectionVersion(){return z()},get characterStore(){return h()},get onSelectOption(){return W()},get onToggleExpand(){return t()},nested:!0}),N(se,U)}),N(R,B)};ne(pe,R=>{v(e()),_(()=>e().featureOptions)&&R(me)})}N(y,D)};ne(I,y=>{n(l)&&y(q)})}C(k),ee(y=>{_e(k,1,`feature-card ${n(s)?"incomplete":n(r)?"complete":""} ${$()?"nested":""}`,"svelte-oj22ap"),M=_e(E,1,"feature-header svelte-oj22ap",null,M,y),te(T,`${v(e()),_(()=>e().name)??""} `),te(j,n(l)?"–":"+")},[()=>({"has-conflicts":n(d)})]),be("click",E,()=>t()(e().name)),N(i,k),Se(),c()}function Ht(i,a){Ce(a,!1);const[p,c]=Oe(),m=()=>Ne($e,"$conflicts",p);let l=x(a,"features",8),s=x(a,"featureSelections",12),r=x(a,"expandedFeatures",12),u=x(a,"selectionVersion",8),d=x(a,"characterStore",8),e=x(a,"onBumpVersion",8);function o(t,f,S){if(!S)return;const A=S,P=t.featureOptions?.numPicks||1;s()[t.name]?z(s()[t.name],P):s(s()[t.name]=Array(P).fill(null),!0);const k=s()[t.name][f],E=[...s()[t.name]];if(E[f]=A,s({...s(),[t.name]:E}),e()(),k===A)return;s(_t(t,s()));const M=`feature:${t.name}:${f}`;if(h(t,A,M,f),k){const O=de(t,[k])||[];for(const T of O){if(T.featureOptions)continue;const g=`feature:${t.name}:${f}:${T.name}`;ge(g,{})}}setTimeout(()=>{Ie($e)},0)}function V(t){r().has(t)?r().delete(t):r().add(t),r(new Set(r()))}function z(t,f){if(t.length<f){const S=t.length;t.length=f;for(let A=S;A<f;A++)t[A]=null}}function h(t,f,S,A){const P={},k={},E=t.effects||[];for(const O of E){if(!ht(O))continue;const T=(b,j=!1)=>{if(typeof b!="string")return b;let I=b.replace(/\{userChoice\}/g,f);return j&&(I=I.toLowerCase().replace(/\s+/g,"_")),I},g=T(O.target,!0),F=T(O.value);switch(O.action){case"add":{const b=Array.isArray(F)?F:[F];P[g]||(P[g]=[]),P[g].push(...b);break}case"set":{P[g]=F;break}case"modify":{const b=Number(F);isNaN(b)||(k[g]=(k[g]??0)+b);break}}}ge(S,P,k);const M=de(t,[f])||[];for(const O of M){if(O.featureOptions)continue;const T=`feature:${t.name}:${A}:${O.name}`,g={},F={};for(const b of O.effects||[]){const j=b.target,I=b.value;switch(b.action){case"add":{const q=Array.isArray(I)?I:[I];g[j]||(g[j]=[]),g[j].push(...q);break}case"set":{g[j]=I;break}case"modify":{const q=Number(I);isNaN(q)||(F[j]=(F[j]??0)+q);break}}}ge(T,g,F)}}ke();var $=ce(),W=X($);ie(W,1,l,t=>t.name,(t,f)=>{var S=ce(),A=X(S);De(A,()=>(n(f),v(u()),m(),_(()=>`${n(f).name}:${u()}:${m().hasConflicts}`)),P=>{Le(P,{get feature(){return n(f)},get featureSelections(){return s()},get expandedFeatures(){return r()},get selectionVersion(){return u()},get characterStore(){return d()},onSelectOption:o,onToggleExpand:V})}),N(t,S)}),N(i,$),Se(),c()}var Nt=Y('<div class="conflict-item svelte-1unacg1"><div class="conflict-description svelte-1unacg1"> </div> <div class="conflict-resolution svelte-1unacg1"><strong>Resolution:</strong> </div></div>'),wt=Y('<div class="conflicts-list svelte-1unacg1"></div> <div class="guidance-section svelte-1unacg1"><p class="svelte-1unacg1">Go to the highlighted tabs and make different selections to avoid duplicates.</p></div>',1),At=Y('<div class="conflict-warning-container svelte-1unacg1"><div class="conflict-warning svelte-1unacg1"><button class="warning-header svelte-1unacg1"><div class="header-content svelte-1unacg1"><span class="warning-icon svelte-1unacg1">⚠️</span> <h3 class="svelte-1unacg1">Conflicts Detected</h3></div> <span class="expand-indicator svelte-1unacg1"> </span></button> <!></div></div>');function Gt(i,a){Ce(a,!1);const[p,c]=Oe(),m=()=>Ne(Ve,"$activeConflicts",p),l=Q();let s=x(a,"tabName",8,""),r=Q(!1);function u(){J(r,!n(r))}function d(h){const W={skill:"Skill",proficiency:"Proficiency",language:"Language",feature:"Feature"}[h.type]||h.type,t=h.sources.map(f=>f.startsWith("bard.")?"Bard class":f.startsWith("high_elf.")?"High Elf race":f.startsWith("hill_dwarf.")?"Hill Dwarf race":f.startsWith("fighter.")?"Fighter class":f);return`${W} "${h.value}" is granted by multiple sources: ${t.join(", ")}`}function e(h){const $=pt(h);return $?`Go to the ${$.charAt(0).toUpperCase()+$.slice(1)} tab and select a different ${h.type} to resolve this conflict.`:"This conflict involves automatic grants. Consider changing your other selections."}ae(()=>(m(),v(s())),()=>{J(l,m().conflicts.filter(h=>h.affectedTabs?.includes(s())??!1))}),Ee(),ke();var o=ce(),V=X(o);{var z=h=>{var $=At(),W=w($),t=w(W),f=G(w(t),2),S=w(f,!0);C(f),C(t);var A=G(t,2);{var P=k=>{var E=wt(),M=X(E);ie(M,5,()=>n(l),je,(O,T)=>{var g=Nt(),F=w(g),b=w(F,!0);C(F);var j=G(F,2),I=G(w(j));C(j),C(g),ee((q,y)=>{te(b,q),te(I,` ${y??""}`)},[()=>(n(T),_(()=>d(n(T)))),()=>(n(T),_(()=>e(n(T))))]),N(O,g)}),C(M),ft(2),N(k,E)};ne(A,k=>{n(r)&&k(P)})}C(W),C($),ee(()=>te(S,n(r)?"−":"+")),be("click",t,u),N(h,$)};ne(V,h=>{n(l),_(()=>n(l).length>0)&&h(z)})}N(i,o),Se(),c()}export{Gt as C,Ht as F,mt as h,Re as i};
