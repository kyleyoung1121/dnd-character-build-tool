import"./DsnmJJEf.js";import"./69_IOA4Y.js";import{l as ue,X as _e,aZ as Ge,a_ as Ye,aW as Ze,W as ze,a8 as Je,$ as Xe,aw as Ke,at as Qe,a2 as ye,aJ as et,aB as tt,aj as ee,c as at,a$ as nt,aa as st,ac as rt,aT as ot,aS as it,Z as $e,ae as ct,Y as lt,a3 as fe,x as Ce,af as ae,s as K,ah as Q,a7 as v,a as r,ag as Fe,y as j,C as w,B as H,E as C,u as h,z as N,A as Se,am as z,aM as Ee,al as ce,an as ft}from"./Bdjag3zs.js";import{e as ie,i as qe}from"./So6lF2Dq.js";import{i as ke}from"./BbSQGgxI.js";import{p as $}from"./BB9x7ZTb.js";import{i as ne,s as Oe,a as Ne}from"./vJ5Czfxm.js";import{g as Ie,s as te,e as be}from"./BVPYibDR.js";import{a as ge}from"./bWUy9njV.js";import{a as Re,c as Pe}from"./6mwyRL5i.js";import{s as ut}from"./C6ClwP9-.js";import{s as he}from"./BOqnH6kl.js";import{i as dt,s as vt}from"./B-vw13G3.js";import{g as pt}from"./BPaQ4App.js";function Ve(c,n,p){ue&&_e();var l=c,m=et,o,t,s=null,u=Ge()?Ye:Ze;function d(){o&&tt(o),s!==null&&(s.lastChild.remove(),l.before(s),s=null),o=t}ze(()=>{if(u(m,m=n())){var e=l,i=Qe();i&&(s=document.createDocumentFragment(),s.append(e=Je())),t=Xe(()=>p(e)),i?Ke.add_callback(d):d()}}),ue&&(l=ye)}function mt(c,n,p=!1,l=!1,m=!1){var o=c,t="";ee(()=>{var s=at;if(t===(t=n()??"")){ue&&_e();return}if(s.nodes_start!==null&&(nt(s.nodes_start,s.nodes_end),s.nodes_start=s.nodes_end=null),t!==""){if(ue){ye.data;for(var u=_e(),d=u;u!==null&&(u.nodeType!==st||u.data!=="");)d=u,u=rt(u);if(u===null)throw ot(),it;$e(ye,d),o=ct(u);return}var e=t+"";p?e=`<svg>${e}</svg>`:l&&(e=`<math>${e}</math>`);var i=lt(e);if((p||l)&&(i=fe(i)),$e(fe(i),i.lastChild),p||l)for(;fe(i);)o.before(fe(i));else o.before(i)}})}function De(c,n){if(!c.featureOptions)return!1;const p=n[c.name]||[],l=c.featureOptions.numPicks||1;if(p.filter(t=>t!==null&&t!=="").length<l)return!0;const o=de(c,p);if(o.length>0){for(const t of o)if(De(t,n))return!0}return!1}function de(c,n){if(!c.featureOptions)return[];const p=[];for(const l of c.featureOptions.options){const m=typeof l=="string"?l:l.name;n.includes(m)&&typeof l!="string"&&l.nestedPrompts&&p.push(...l.nestedPrompts)}return p}function gt(c,n,p,l){const m=c.featureOptions?.options||[],o=p[c.name]||[],t=o[n]??null,s=Ie(l),u=new Set;if(Array.isArray(s.skills))for(const d of s.skills)u.add(d);if(Array.isArray(s.languages))for(const d of s.languages)u.add(d);if(Array.isArray(s.proficiencies))for(const d of s.proficiencies)u.add(d);for(const[d,e]of Object.entries(p))for(const[i,R]of(e||[]).entries())R&&(d===c.name&&i===n||u.add(R));return m.filter(d=>{const e=typeof d=="string"?d:d.name;return o.some((i,R)=>i===e&&R!==n)?!1:t===e?!0:!u.has(e)})}function ht(c,n){if(!c.featureOptions)return n;const p={...n};let l=!1;function m(o){if(p[o.name]&&(delete p[o.name],l=!0),o.featureOptions){for(const t of o.featureOptions.options)if(typeof t!="string"&&t.nestedPrompts)for(const s of t.nestedPrompts)m(s)}}for(const o of c.featureOptions.options)if(typeof o!="string"&&o.nestedPrompts)for(const t of o.nestedPrompts)m(t);return l?p:n}function _t(c){return typeof c.target=="string"&&c.target.includes("{userChoice}")||typeof c.value=="string"&&c.value.includes("{userChoice}")}var yt=j("<span><!></span>"),bt=j('<option class="svelte-1q8hvhi"> </option>'),Ct=j('<select class="svelte-1q8hvhi"><option disabled class="svelte-1q8hvhi"> </option><!></select>'),St=j("<!> <!>",1),kt=j('<p class="svelte-1q8hvhi"><!></p> <!>',1),Ot=j('<div><button type="button"><span class="feature-name svelte-1q8hvhi"> <!></span> <span class="expand-indicator svelte-1q8hvhi"> </span></button> <!></div>');function Le(c,n){Ce(n,!1);const[p,l]=Oe(),m=()=>Ne(Re,"$activeConflicts",p),o=Q(),t=Q(),s=Q(),u=Q(),d=Q();let e=$(n,"feature",8),i=$(n,"featureSelections",8),R=$(n,"expandedFeatures",8),J=$(n,"selectionVersion",8),_=$(n,"characterStore",8),P=$(n,"nested",8,!1),W=$(n,"onSelectOption",8),a=$(n,"onToggleExpand",8);function f(y){return m().hasConflicts?m().conflicts.some(V=>V.sources.some(B=>B.includes(y))):!1}function S(y){return r(d)?e().featureOptions?"user-changeable":"automatic":"none"}function A(y){return gt(e(),y,i(),_())}function E(y,V){const B=y.target;W()(e(),V,B.value)}ae(()=>(v(R()),v(e())),()=>{K(o,R().has(e().name))}),ae(()=>(v(e()),v(i())),()=>{K(t,De(e(),i()))}),ae(()=>(r(t),v(e())),()=>{K(s,!r(t)&&e().featureOptions)}),ae(()=>(v(e()),v(i())),()=>{K(u,de(e(),i()[e().name]||[]))}),ae(()=>v(e()),()=>{K(d,f(e().name))}),Fe(),ke();var k=Ot(),F=w(k);let M;var O=w(F),T=w(O),g=H(T);{var x=y=>{var V=yt();let B;var ve=w(V);{var pe=D=>{var Y=Ee("⚠️");N(D,Y)},me=D=>{var Y=Ee("ℹ️");N(D,Y)};ne(ve,D=>{v(e()),h(()=>S(e().name)==="user-changeable")?D(pe):D(me,!1)})}C(V),ee((D,Y)=>{B=he(V,1,"conflict-badge svelte-1q8hvhi",null,B,D),ut(V,"title",Y)},[()=>({"user-changeable":S(e().name)==="user-changeable",automatic:S(e().name)==="automatic"}),()=>(v(e()),h(()=>S(e().name)==="user-changeable"?"You can change this selection to resolve conflicts":"This feature conflicts with your other selections"))]),N(y,V)};ne(g,y=>{r(d)&&y(x)})}C(O);var b=H(O,2),q=w(b,!0);C(b),C(F);var I=H(F,2);{var G=y=>{var V=kt(),B=z(V),ve=w(B);mt(ve,()=>(v(e()),h(()=>e().description))),C(B);var pe=H(B,2);{var me=D=>{var Y=St(),we=z(Y);ie(we,1,()=>(v(e()),h(()=>Array(e().featureOptions.numPicks))),qe,(se,Ae,U)=>{var le=ce(),Be=z(le);Ve(Be,()=>(v(e()),v(J()),h(()=>`${e().name}:${U}:${J()}`)),He=>{var Z=Ct(),re=w(Z),Me=w(re,!0);C(re),re.value=re.__value="";var Ue=H(re);ie(Ue,1,()=>h(()=>A(U)),X=>typeof X=="string"?X:X.name,(X,L)=>{var oe=bt(),je=w(oe,!0);C(oe);var xe={};ee(()=>{te(je,(r(L),h(()=>typeof r(L)=="string"?r(L):r(L).name))),xe!==(xe=(r(L),h(()=>typeof r(L)=="string"?r(L):r(L).name)))&&(oe.value=(oe.__value=(r(L),h(()=>typeof r(L)=="string"?r(L):r(L).name)))??"")}),N(X,oe)}),C(Z);var Te;dt(Z),ee(()=>{te(Me,(v(e()),h(()=>e().featureOptions.placeholderText||"Select an option"))),Te!==(Te=(v(i()),v(e()),h(()=>i()[e().name]?.[U]||"")))&&(Z.value=(Z.__value=(v(i()),v(e()),h(()=>i()[e().name]?.[U]||"")))??"",vt(Z,(v(i()),v(e()),h(()=>i()[e().name]?.[U]||""))))}),be("change",Z,X=>E(X,U)),N(He,Z)}),N(se,le)});var We=H(we,2);ie(We,1,()=>r(u),se=>se.name,(se,Ae)=>{var U=ce(),le=z(U);Le(le,{get feature(){return r(Ae)},get featureSelections(){return i()},get expandedFeatures(){return R()},get selectionVersion(){return J()},get characterStore(){return _()},get onSelectOption(){return W()},get onToggleExpand(){return a()},nested:!0}),N(se,U)}),N(D,Y)};ne(pe,D=>{v(e()),h(()=>e().featureOptions)&&D(me)})}N(y,V)};ne(I,y=>{r(o)&&y(G)})}C(k),ee(y=>{he(k,1,`feature-card ${r(t)?"incomplete":r(s)?"complete":""} ${P()?"nested":""}`,"svelte-1q8hvhi"),M=he(F,1,"feature-header svelte-1q8hvhi",null,M,y),te(T,`${v(e()),h(()=>e().name)??""} `),te(q,r(o)?"–":"+")},[()=>({"has-conflicts":r(d)})]),be("click",F,()=>a()(e().name)),N(c,k),Se(),l()}function Ht(c,n){Ce(n,!1);const[p,l]=Oe(),m=()=>Ne(Pe,"$conflicts",p);let o=$(n,"features",8),t=$(n,"featureSelections",12),s=$(n,"expandedFeatures",12),u=$(n,"selectionVersion",8),d=$(n,"characterStore",8),e=$(n,"onBumpVersion",8);function i(a,f,S){if(!S)return;const A=S,E=a.featureOptions?.numPicks||1;t()[a.name]?J(t()[a.name],E):t(t()[a.name]=Array(E).fill(null),!0);const k=t()[a.name][f],F=[...t()[a.name]];if(F[f]=A,t({...t(),[a.name]:F}),e()(),k===A)return;t(ht(a,t()));const M=`feature:${a.name}:${f}`;if(_(a,A,M,f),k){const O=de(a,[k])||[];for(const T of O){if(T.featureOptions)continue;const g=`feature:${a.name}:${f}:${T.name}`;ge(g,{})}}setTimeout(()=>{Ie(Pe)},0)}function R(a){s().has(a)?s().delete(a):s().add(a),s(new Set(s()))}function J(a,f){if(a.length<f){const S=a.length;a.length=f;for(let A=S;A<f;A++)a[A]=null}}function _(a,f,S,A){const E={},k={},F=a.effects||[];for(const O of F){if(!_t(O))continue;const T=(b,q=!1)=>{if(typeof b!="string")return b;let I=b.replace(/\{userChoice\}/g,f);return q&&(I=I.toLowerCase().replace(/\s+/g,"_")),I},g=T(O.target,!0),x=T(O.value);switch(O.action){case"add":{const b=Array.isArray(x)?x:[x];E[g]||(E[g]=[]),E[g].push(...b);break}case"set":{E[g]=x;break}case"modify":{const b=Number(x);isNaN(b)||(k[g]=(k[g]??0)+b);break}}}ge(S,E,k);const M=de(a,[f])||[];for(const O of M){if(O.featureOptions)continue;const T=`feature:${a.name}:${A}:${O.name}`,g={},x={};for(const b of O.effects||[]){const q=b.target,I=b.value;switch(b.action){case"add":{const G=Array.isArray(I)?I:[I];g[q]||(g[q]=[]),g[q].push(...G);break}case"set":{g[q]=I;break}case"modify":{const G=Number(I);isNaN(G)||(x[q]=(x[q]??0)+G);break}}}ge(T,g,x)}}ke();var P=ce(),W=z(P);ie(W,1,o,a=>a.name,(a,f)=>{var S=ce(),A=z(S);Ve(A,()=>(r(f),v(u()),m(),h(()=>`${r(f).name}:${u()}:${m().hasConflicts}`)),E=>{Le(E,{get feature(){return r(f)},get featureSelections(){return t()},get expandedFeatures(){return s()},get selectionVersion(){return u()},get characterStore(){return d()},onSelectOption:i,onToggleExpand:R})}),N(a,S)}),N(c,P),Se(),l()}var Nt=j('<div class="conflict-item svelte-1unacg1"><div class="conflict-description svelte-1unacg1"> </div> <div class="conflict-resolution svelte-1unacg1"><strong>Resolution:</strong> </div></div>'),wt=j('<div class="conflicts-list svelte-1unacg1"></div> <div class="guidance-section svelte-1unacg1"><p class="svelte-1unacg1">Go to the highlighted tabs and make different selections to avoid duplicates.</p></div>',1),At=j('<div class="conflict-warning-container svelte-1unacg1"><div class="conflict-warning svelte-1unacg1"><button class="warning-header svelte-1unacg1"><div class="header-content svelte-1unacg1"><span class="warning-icon svelte-1unacg1">⚠️</span> <h3 class="svelte-1unacg1">Conflicts Detected</h3></div> <span class="expand-indicator svelte-1unacg1"> </span></button> <!></div></div>');function Mt(c,n){Ce(n,!1);const[p,l]=Oe(),m=()=>Ne(Re,"$activeConflicts",p),o=Q();let t=$(n,"tabName",8,""),s=Q(!1);function u(){K(s,!r(s))}function d(_){const W={skill:"Skill",proficiency:"Proficiency",language:"Language",feature:"Feature"}[_.type]||_.type,a=_.sources.map(f=>f.startsWith("bard.")?"Bard class":f.startsWith("high_elf.")?"High Elf race":f.startsWith("hill_dwarf.")?"Hill Dwarf race":f.startsWith("fighter.")?"Fighter class":f);return`${W} "${_.value}" is granted by multiple sources: ${a.join(", ")}`}function e(_){const P=pt(_);return P?`Go to the ${P.charAt(0).toUpperCase()+P.slice(1)} tab and select a different ${_.type} to resolve this conflict.`:"This conflict involves automatic grants. Consider changing your other selections."}ae(()=>(m(),v(t())),()=>{K(o,m().conflicts.filter(_=>_.affectedTabs?.includes(t())??!1))}),Fe(),ke();var i=ce(),R=z(i);{var J=_=>{var P=At(),W=w(P),a=w(W),f=H(w(a),2),S=w(f,!0);C(f),C(a);var A=H(a,2);{var E=k=>{var F=wt(),M=z(F);ie(M,5,()=>r(o),qe,(O,T)=>{var g=Nt(),x=w(g),b=w(x,!0);C(x);var q=H(x,2),I=H(w(q));C(q),C(g),ee((G,y)=>{te(b,G),te(I,` ${y??""}`)},[()=>(r(T),h(()=>d(r(T)))),()=>(r(T),h(()=>e(r(T))))]),N(O,g)}),C(M),ft(2),N(k,F)};ne(A,k=>{r(s)&&k(E)})}C(W),C(P),ee(()=>te(S,r(s)?"−":"+")),be("click",a,u),N(_,P)};ne(R,_=>{r(o),h(()=>r(o).length>0)&&_(J)})}N(c,i),Se(),l()}export{Mt as C,Ht as F,_t as e,mt as h,De as i};
