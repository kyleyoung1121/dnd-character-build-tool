import{c as v}from"./CIqA3WZi.js";function _(t,i={},c){v.update(r=>{r._provenance?.[t]&&(r=m(r,t));const p={},l={};for(const[f,y]of Object.entries(i)){const n=f,e=r[n];Array.isArray(e)&&Array.isArray(y)?r[n]=[...e,...y]:(p[n]=e,r[n]=y)}if(c)for(const[f,y]of Object.entries(c)){const n=f,e=r[n];l[n]=e;const o=Number(y)||0,s=typeof e=="number"?e:0;r[n]=s+o}return r._provenance??={},r._provenance[t]={_set:Object.keys(i).length?i:null,_prevScalars:Object.keys(p).length?p:null,_mods:c&&Object.keys(c).length?c:null,_modsPrev:Object.keys(l).length?l:null},r})}function m(t,i){const c=t._provenance?.[i];if(!c)return t;if(!("_set"in c)&&!("_mods"in c)){const n=t._provenance;for(const[e,o]of Object.entries(c)){const s=e;Array.isArray(t[s])&&Array.isArray(o)?t[s]=b(t[s],o,i,e,n):t[s]=Array.isArray(o)?[]:null}return delete t._provenance?.[i],t}const{_set:r,_prevScalars:p,_mods:l,_modsPrev:f}=c,y=t._provenance;if(r)for(const[n,e]of Object.entries(r)){const o=n;if(Array.isArray(e))t[o]=b(t[o],e,i,n,y);else{const s=p?.[o];t[o]=s??null}}if(l)for(const n of Object.keys(l)){const e=n;if(["strength","dexterity","constitution","intelligence","wisdom","charisma"].includes(n)){const s=Number(l[n])||0,u=t[e],a=typeof u=="number"?u:0;t[e]=a-s}else if(f&&Object.prototype.hasOwnProperty.call(f,e))t[e]=f[e];else{const s=Number(l[n])||0,u=t[e],a=typeof u=="number"?u:0;t[e]=a-s}}return delete t._provenance?.[i],t}function b(t,i,c,r,p){if(!p)return t.filter(e=>!i.includes(e));const l={};for(const[e,o]of Object.entries(p)){const s="_set"in o&&o._set?o._set:o;if(!(!s||!Array.isArray(s[r])))for(const u of s[r])l[u]||(l[u]={}),l[u][e]=(l[u][e]||0)+1}const f={};for(const e of i){const o=l[e]||{};f[e]=o[c]||0}const y=[],n={};for(const e of t)if(i.includes(e)){const o=f[e]||0,s=n[e]||0;s<o?n[e]=s+1:y.push(e)}else y.push(e);return y}function A(t,i={},c){return _(t,i,c),{applied:!0}}export{_ as a,A as b,m as r};
