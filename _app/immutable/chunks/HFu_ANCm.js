import"./DsnmJJEf.js";import"./CLB9eUYX.js";import{h as Se,C as Me,aU as Re,aV as We,aW as qe,B as Ye,K as Ze,M as $e,O as Ke,Q as Qe,V as Xe,U as Je,T as et,W as Ae,ar as Y,j as Z,z as $,al as l,d as c,as as tt,X,$ as H,_ as K,a0 as z,au as oe,v as _,Y as D,Z as xe,ay as Q,aO as ke,ax as le}from"./rn6nHgdH.js";import{e as ce,i as nt}from"./CAQU5EIs.js";import{i as Ne}from"./hD6VUnFp.js";import{p as w}from"./Rsg3wwRt.js";import{s as Pe,a as Fe}from"./Cb9z2JfB.js";import{g as ve,a as re,e as we}from"./ZJQv4x7Q.js";import{a as me,b as st}from"./Dnzb4z2X.js";import{a as at,c as Ce}from"./2B6LwRL0.js";import{i as ie}from"./Co363syM.js";import{h as ot}from"./BeNoI1Wt.js";import{s as rt}from"./BXwS9YYZ.js";import{s as ge}from"./CHpWTfCS.js";import{i as it,s as ct}from"./COMRBWPk.js";function De(n,a,f){Se&&Me();var r=n,p=Je,i,s,t=null,g=Re()?We:qe;function v(){i&&et(i),t!==null&&(t.lastChild.remove(),r.before(t),t=null),i=s}Ye(()=>{if(g(p,p=a())){var y=r,e=Qe();e&&(t=document.createDocumentFragment(),t.append(y=Ze())),s=$e(()=>f(y)),e?Ke.add_callback(v):v()}}),Se&&(r=Xe)}function ye(n,a){if(!n.featureOptions)return!1;const f=a[n.name]||[],r=n.featureOptions.numPicks||1;if(f.filter(s=>s!==null&&s!=="").length<r)return!0;const i=se(n,f);if(i.length>0){for(const s of i)if(ye(s,a))return!0}return!1}function se(n,a){if(!n.featureOptions)return[];const f=[];for(const r of n.featureOptions.options||[]){const p=typeof r=="string"?r:r.name;a.includes(p)&&typeof r!="string"&&r.nestedPrompts&&f.push(...r.nestedPrompts)}return f}function Ie(n,a,f,r){let p=n.featureOptions?.options||[];n.featureOptions?.dynamicOptionsGenerator&&(p=Ve(n.featureOptions.dynamicOptionsGenerator,r,f));const i=f[n.name]||[],s=i[a]??null,t=ve(r),g=new Set,v=n.name.toLowerCase().includes("expertise");if(Array.isArray(t.skills)&&!v)for(const e of t.skills)g.add(e);if(Array.isArray(t.languages))for(const e of t.languages)g.add(e);if(Array.isArray(t.proficiencies))for(const e of t.proficiencies)g.add(e);if(v&&Array.isArray(t.expertise))for(const e of t.expertise)g.add(e);for(const[e,u]of Object.entries(f))for(const[j,T]of(u||[]).entries())T&&(e===n.name&&j===a||g.add(T));const y=p.filter(e=>{const u=typeof e=="string"?e:e.name;return i.some((j,T)=>j===u&&T!==a)?!1:s===u?!0:v?!(Array.isArray(t.expertise)&&t.expertise.includes(u)):!g.has(u)});return typeof window<"u"&&window.dynamicOptionsDebug&&(window.dynamicOptionsDebug.filtering={featureName:n.name,index:a,isExpertiseFeature:v,rawOptions:p,chosenHere:i,currentValue:s,taken:Array.from(g),expertiseAlreadyChosen:v?t.expertise||[]:[],finalFiltered:y,timestamp:new Date().toISOString()}),y}function Te(n,a){if(!n.featureOptions)return a;const f={...a};let r=!1;function p(i){if(f[i.name]&&(delete f[i.name],r=!0),i.featureOptions){for(const s of i.featureOptions.options||[])if(typeof s!="string"&&s.nestedPrompts)for(const t of s.nestedPrompts)p(t)}}for(const i of n.featureOptions.options||[])if(typeof i!="string"&&i.nestedPrompts)for(const s of i.nestedPrompts)p(s);return r?f:a}function Ve(n,a,f){const r=ve(a);typeof window<"u"&&window.dynamicOptionsDebug?window.dynamicOptionsDebug.lastCall={generatorType:n.type,additionalOptions:n.additionalOptions,characterStoreState:r,skillsArray:r?.skills,featureSelections:f,timestamp:new Date().toISOString()}:typeof window<"u"&&(window.dynamicOptionsDebug={lastCall:{generatorType:n.type,additionalOptions:n.additionalOptions,characterStoreState:r,skillsArray:r?.skills,featureSelections:f,timestamp:new Date().toISOString()}});const p=["Acrobatics","Animal Handling","Arcana","Athletics","Deception","History","Insight","Intimidation","Investigation","Medicine","Nature","Perception","Performance","Persuasion","Religion","Sleight of Hand","Stealth","Survival"];switch(n.type){case"proficient-skills-plus-tools":{const i=[];if(Array.isArray(r.skills)&&i.push(...r.skills),Array.isArray(r.proficiencies))for(const t of r.proficiencies)p.includes(t)&&i.push(t);if(f){for(const[t,g]of Object.entries(f))if(t.toLowerCase().includes("skill")||t.toLowerCase().includes("proficiencies")||t==="Skill Proficiencies"||t.includes("Skills"))for(const y of g)y&&typeof y=="string"&&p.includes(y)&&i.push(y)}i.push(...n.additionalOptions);const s=[...new Set(i)];return typeof window<"u"&&window.dynamicOptionsDebug&&(window.dynamicOptionsDebug.lastCall.finalOptions=s),s}default:return[]}}function Ee(n){return typeof n.target=="string"&&n.target.includes("{userChoice}")||typeof n.value=="string"&&n.value.includes("{userChoice}")}const Ft=Object.freeze(Object.defineProperty({__proto__:null,clearNestedFeatureSelections:Te,effectNeedsChoice:Ee,generateDynamicOptions:Ve,getGloballyAvailableOptions:Ie,getNestedPrompts:se,isFeatureIncomplete:ye},Symbol.toStringTag,{value:"Module"}));var lt=X("<span><!></span>"),ft=X('<option class="svelte-1cl69m0"> </option>'),ut=X('<select class="svelte-1cl69m0"><option disabled class="svelte-1cl69m0"> </option><!></select>'),pt=X("<!> <!>",1),dt=X('<p class="svelte-1cl69m0"><!></p> <!>',1),mt=X('<div><button type="button"><span class="feature-name svelte-1cl69m0"> <!></span> <span class="expand-indicator svelte-1cl69m0"> </span></button> <!></div>');function Le(n,a){Ae(a,!1);const[f,r]=Pe(),p=()=>Fe(at,"$activeConflicts",f),i=$(),s=$(),t=$(),g=$(),v=$(),y=$();let e=w(a,"feature",8),u=w(a,"featureSelections",8),j=w(a,"expandedFeatures",8),T=w(a,"selectionVersion",8),q=w(a,"characterStore",8),fe=w(a,"nested",8,!1),o=w(a,"onSelectOption",8),m=w(a,"onToggleExpand",8);function A(d){return p().hasConflicts?p().conflicts.some(N=>N.sources.some(L=>L.includes(d))):!1}function h(d){return c(v)?e().featureOptions?"user-changeable":"automatic":"none"}function O(d,N){const L=d.target;o()(e(),N,L.value)}Y(()=>(l(j()),l(e())),()=>{Z(i,j().has(e().name))}),Y(()=>(l(e()),l(u())),()=>{Z(s,ye(e(),u()))}),Y(()=>(c(s),l(e())),()=>{Z(t,!c(s)&&e().featureOptions)}),Y(()=>(l(e()),l(u())),()=>{Z(g,se(e(),u()[e().name]||[]))}),Y(()=>l(e()),()=>{Z(v,A(e().name))}),Y(()=>(l(e()),l(u()),l(q())),()=>{Z(y,d=>Ie(e(),d,u(),q()))}),tt(),Ne();var C=mt(),V=H(C);let J;var R=H(V),b=H(R),B=K(b);{var S=d=>{var N=lt();let L;var ue=H(N);{var pe=P=>{var G=ke("⚠️");D(P,G)},de=P=>{var G=ke("🔒");D(P,G)};ie(ue,P=>{l(e()),_(()=>h(e().name)==="user-changeable")?P(pe):P(de,!1)})}z(N),oe((P,G)=>{L=ge(N,1,"conflict-badge svelte-1cl69m0",null,L,P),rt(N,"title",G)},[()=>({"user-changeable":h(e().name)==="user-changeable",automatic:h(e().name)==="automatic"}),()=>(l(e()),_(()=>h(e().name)==="user-changeable"?"You can change this selection to resolve conflicts":"This feature conflicts with your other selections, but has no alternative options"))]),D(d,N)};ie(B,d=>{c(v)&&d(S)})}z(R);var x=K(R,2),k=H(x,!0);z(x),z(V);var E=K(V,2);{var I=d=>{var N=dt(),L=Q(N),ue=H(L);ot(ue,()=>(l(e()),_(()=>e().description))),z(L);var pe=K(L,2);{var de=P=>{var G=pt(),he=Q(G);ce(he,1,()=>(l(e()),_(()=>Array(e().featureOptions.numPicks))),nt,(ee,_e,U)=>{var ae=le(),Ue=Q(ae);De(Ue,()=>(l(e()),l(T()),_(()=>`${e().name}:${U}:${T()}`)),He=>{var M=ut(),te=H(M),ze=H(te,!0);z(te),te.value=te.__value="";var Be=K(te);ce(Be,1,()=>(c(y),_(()=>c(y)(U))),W=>typeof W=="string"?W:W.name,(W,F)=>{var ne=ft(),Ge=H(ne,!0);z(ne);var be={};oe(()=>{re(Ge,(c(F),_(()=>typeof c(F)=="string"?c(F):c(F).name))),be!==(be=(c(F),_(()=>typeof c(F)=="string"?c(F):c(F).name)))&&(ne.value=(ne.__value=(c(F),_(()=>typeof c(F)=="string"?c(F):c(F).name)))??"")}),D(W,ne)}),z(M);var Oe;it(M),oe(()=>{re(ze,(l(e()),_(()=>e().featureOptions.placeholderText||"Select an option"))),Oe!==(Oe=(l(u()),l(e()),_(()=>u()[e().name]?.[U]||"")))&&(M.value=(M.__value=(l(u()),l(e()),_(()=>u()[e().name]?.[U]||"")))??"",ct(M,(l(u()),l(e()),_(()=>u()[e().name]?.[U]||""))))}),we("change",M,W=>O(W,U)),D(He,M)}),D(ee,ae)});var je=K(he,2);ce(je,1,()=>c(g),ee=>ee.name,(ee,_e)=>{var U=le(),ae=Q(U);Le(ae,{get feature(){return c(_e)},get featureSelections(){return u()},get expandedFeatures(){return j()},get selectionVersion(){return T()},get characterStore(){return q()},get onSelectOption(){return o()},get onToggleExpand(){return m()},nested:!0}),D(ee,U)}),D(P,G)};ie(pe,P=>{l(e()),_(()=>e().featureOptions)&&P(de)})}D(d,N)};ie(E,d=>{c(i)&&d(I)})}z(C),oe(d=>{ge(C,1,`feature-card ${c(s)?"incomplete":c(t)?"complete":""} ${fe()?"nested":""}`,"svelte-1cl69m0"),J=ge(V,1,"feature-header svelte-1cl69m0",null,J,d),re(b,`${l(e()),_(()=>e().name)??""} `),re(k,c(i)?"–":"+")},[()=>({"has-conflicts":c(v)})]),we("click",V,()=>m()(e().name)),D(n,C),xe(),r()}function Dt(n,a){Ae(a,!1);const[f,r]=Pe(),p=()=>Fe(Ce,"$conflicts",f);let i=w(a,"features",8),s=w(a,"featureSelections",12),t=w(a,"expandedFeatures",12),g=w(a,"selectionVersion",8),v=w(a,"characterStore",8),y=w(a,"onBumpVersion",8);function e(o,m,A){if(!A)return;const h=A,O=o.featureOptions?.numPicks||1;s()[o.name]?j(s()[o.name],O):s(s()[o.name]=Array(O).fill(null),!0);const C=s()[o.name][m],V=[...s()[o.name]];if(V[m]=h,s({...s(),[o.name]:V}),y()(),C===h)return;s(Te(o,s()));const J=`feature:${o.name}:${m}`;if(C){const R=se(o,[C])||[];for(const b of R){if(b.featureOptions)continue;const B=`feature:${o.name}:${m}:${b.name}`;me(B,{})}}T(o,h,J,m),setTimeout(()=>{ve(Ce)},0)}function u(o){t().has(o)?t().delete(o):t().add(o),t(new Set(t()))}function j(o,m){if(o.length<m){const A=o.length;o.length=m;for(let h=A;h<m;h++)o[h]=null}}function T(o,m,A,h){const O={},C={},V=o.effects||[];for(const b of V){if(!Ee(b))continue;const B=(k,E=!1)=>{if(typeof k!="string")return k;let I=k.replace(/\{userChoice\}/g,m);return E&&(I=I.toLowerCase().replace(/\s+/g,"_")),I},S=B(b.target,!0),x=B(b.value);switch(b.action){case"add":{const k=Array.isArray(x)?x:[x];O[S]||(O[S]=[]),O[S].push(...k);break}case"set":{O[S]=x;break}case"modify":{const k=Number(x);isNaN(k)||(C[S]=(C[S]??0)+k);break}}}Object.keys(O).includes("subclass")?st(A,O,C):me(A,O,C);const R=se(o,[m])||[];for(const b of R){if(b.featureOptions)continue;const B=`feature:${o.name}:${h}:${b.name}`,S={},x={};for(const k of b.effects||[]){const E=k.target,I=k.value;switch(k.action){case"add":{const d=Array.isArray(I)?I:[I];S[E]||(S[E]=[]),S[E].push(...d);break}case"set":{S[E]=I;break}case"modify":{const d=Number(I);isNaN(d)||(x[E]=(x[E]??0)+d);break}}}me(B,S,x)}}Ne();var q=le(),fe=Q(q);ce(fe,1,i,o=>o.name,(o,m)=>{var A=le(),h=Q(A);De(h,()=>(c(m),l(g()),p(),_(()=>`${c(m).name}:${g()}:${p().hasConflicts}`)),O=>{Le(O,{get feature(){return c(m)},get featureSelections(){return s()},get expandedFeatures(){return t()},get selectionVersion(){return g()},get characterStore(){return v()},onSelectOption:e,onToggleExpand:u})}),D(o,A)}),D(n,q),xe(),r()}export{Dt as F,Ee as e,Ft as f,ye as i};
